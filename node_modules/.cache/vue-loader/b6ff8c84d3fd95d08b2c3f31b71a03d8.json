{"remainingRequest":"/Users/hujun/Downloads/永益科技后端/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/hujun/Downloads/永益科技后端/src/pages/product/productList/index.vue?vue&type=style&index=0&id=b77c4908&scoped=true&lang=stylus&","dependencies":[{"path":"/Users/hujun/Downloads/永益科技后端/src/pages/product/productList/index.vue","mtime":1610587844000},{"path":"/Users/hujun/Downloads/永益科技后端/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hujun/Downloads/永益科技后端/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/hujun/Downloads/永益科技后端/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/hujun/Downloads/永益科技后端/node_modules/stylus-loader/index.js","mtime":1519606876000},{"path":"/Users/hujun/Downloads/永益科技后端/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hujun/Downloads/永益科技后端/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgovZGVlcC8uaXZ1LW1vZGFsLW1hc2sKICB6LWluZGV4IDk5OSFpbXBvcnRhbnQ7Ci9kZWVwLy5pdnUtbW9kYWwtd3JhcAogIHotaW5kZXggOTk5IWltcG9ydGFudDsKLkJveAogID4+PiAuaXZ1LW1vZGFsLWJvZHkKICAgIGhlaWdodCA3MDBweAogICAgb3ZlcmZsb3c6IGF1dG87Ci50YWJCb3hfaW1nCiAgd2lkdGggMzZweAogIGhlaWdodCAzNnB4CiAgYm9yZGVyLXJhZGl1czo0cHgKICBjdXJzb3IgcG9pbnRlcgogIGltZwogICAgd2lkdGggMTAwJQogICAgaGVpZ2h0IDEwMCUK"},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwbA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/pages/product/productList","sourcesContent":["<template>\n  <div class=\"article-manager\">\n    <div class=\"i-layout-page-header\">\n      <div class=\"i-layout-page-header\">\n        <span class=\"ivu-page-header-title\">商品管理</span>\n        <div>\n          <Tabs v-model=\"artFrom.type\"  @on-click=\"onClickTab\">\n            <TabPane :label=\"item.name +'('+item.count +')' \" :name=\"item.type.toString()\" v-for=\"(item,index) in headeNum\" :key=\"index\"/>\n          </Tabs>\n        </div>\n      </div>\n    </div>\n    <Card :bordered=\"false\" dis-hover class=\"ivu-mt\">\n      <Form ref=\"artFrom\" :model=\"artFrom\"  :label-width=\"75\" label-position=\"right\" @submit.native.prevent>\n        <Row type=\"flex\" :gutter=\"24\">\n          <Col v-bind=\"grid\">\n            <FormItem label=\"商品分类：\"  label-for=\"pid\">\n              <Select v-model=\"artFrom.cate_id\"  clearable @on-change=\"userSearchs\">\n                <Option v-for=\"item in treeSelect\" :value=\"item.id\" :key=\"item.id\">{{ item.html + item.cate_name }}</Option>\n              </Select>\n            </FormItem>\n          </Col>\n          <Col v-bind=\"grid\">\n            <FormItem label=\"商品搜索：\"  label-for=\"store_name\">\n              <Input search enter-button placeholder=\"请输入商品名称,关键字,ID\" v-model=\"artFrom.store_name\"  @on-search=\"userSearchs\"/>\n            </FormItem>\n          </Col>\n        </Row>\n      </Form>\n      <div class=\"Button\">\n        <router-link v-auth=\"['product-product-save']\" :to=\"'/admin/product/add_product'\"><Button type=\"primary\" class=\"bnt mr15\" icon=\"md-add\">添加商品</Button></router-link>\n        <Button v-auth=\"['product-crawl-save']\" type=\"success\" class=\"bnt mr15\" @click=\"onCopy\">商品采集</Button>\n        <Button v-auth=\"['product-product-product_show']\" class=\"bnt mr15\" @click=\"onDismount\" v-show=\"artFrom.type === '1'\">批量下架</Button>\n        <Button v-auth=\"['product-product-product_show']\" class=\"bnt mr15\" @click=\"onShelves\" v-show=\"artFrom.type === '2'\">批量上架</Button>\n        <Button v-auth=\"['export-storeProduct']\" class=\"export\" icon=\"ios-share-outline\" @click=\"exports\">导出</Button>\n      </div>\n      <Table\n        ref=\"table\"\n        :columns=\"(artFrom.type !== '1' && artFrom.type !== '2')?columns2:columns\"\n        :data=\"tableList\"\n        class=\"ivu-mt\"\n        :loading=\"loading\"\n        highlight-row @on-selection-change=\"onSelectTab\"\n        no-data-text=\"暂无数据\"\n        no-filtered-data-text=\"暂无筛选结果\"\n      >\n        <template slot-scope=\"{ row }\" slot=\"id\">\n          {{ row.id }}\n        </template>\n        <template slot-scope=\"{ row }\" slot=\"image\">\n          <div class=\"tabBox_img\" v-viewer>\n            <img v-lazy=\"row.image\">\n          </div>\n        </template>\n        <template slot-scope=\"{ row, index }\" slot=\"state\">\n          <i-switch v-model=\"row.is_show\" :value=\"row.is_show\" :true-value=\"1\" :false-value=\"0\" @on-change=\"changeSwitch(row)\" size=\"large\">\n            <span slot=\"open\">上架</span>\n            <span slot=\"close\">下架</span>\n          </i-switch>\n        </template>\n        <template slot-scope=\"{ row, index }\" slot=\"action\">\n          <a @click=\"edit(row)\">编辑</a>\n          <Divider type=\"vertical\" />\n          <router-link :to=\"{ path: '/admin/product/product_reply/'+ row.id }\"><a>查看评论</a></router-link>\n          <Divider type=\"vertical\" />\n          <a @click=\"del(row,'恢复商品', index)\" v-if=\"artFrom.type === '6'\">恢复商品</a>\n          <a @click=\"del(row,'移入回收站', index)\" v-else>移到回收站</a>\n        </template>\n      </Table>\n      <div class=\"acea-row row-right page\">\n        <Page :total=\"total\" :current=\"artFrom.page\" show-elevator show-total @on-change=\"pageChange\"\n              :page-size=\"artFrom.limit\"/>\n      </div>\n      <attribute :attrTemplate=\"attrTemplate\" v-on:changeTemplate=\"changeTemplate\"></attribute>\n    </Card>\n    <!-- 生成淘宝京东表单-->\n    <Modal v-model=\"modals\" class=\"Box\" scrollable  footer-hide closable title=\"复制淘宝、天猫、京东、苏宁、1688\" :mask-closable=\"false\"  width=\"1200\" height=\"500\">\n      <tao-bao ref=\"taobaos\" v-if=\"modals\" @on-close=\"onClose\"></tao-bao>\n    </Modal>\n  </div>\n</template>\n\n<script>\n    import expandRow from './tableExpand.vue'\n    import attribute from './attribute'\n    import toExcel from '../../../utils/Excel.js'\n    import { mapState } from 'vuex'\n    import taoBao from './taoBao'\n    import { getGoodHeade, getGoods, PostgoodsIsShow, treeListApi, productShowApi, productUnshowApi, storeProductApi } from '@/api/product'\n    export default {\n        name: 'product_productList',\n        components: { expandRow, attribute, taoBao },\n        computed: {\n            ...mapState('userLevel', [\n                'categoryId'\n            ])\n        },\n        data () {\n            return {\n                template: false,\n                modals: false,\n                grid: {\n                    xl: 6,\n                    lg: 8,\n                    md: 12,\n                    sm: 24,\n                    xs: 24\n                },\n                artFrom: {\n                    page: 1,\n                    limit: 15,\n                    cate_id: '',\n                    type: '1',\n                    store_name: '',\n                    excel: 0\n                },\n                list: [],\n                tableList: [],\n                headeNum: [],\n                treeSelect: [],\n                loading: false,\n                columns: [\n                    {\n                        type: 'expand',\n                        width: 50,\n                        render: (h, params) => {\n                            return h(expandRow, {\n                                props: {\n                                    row: params.row\n                                }\n                            })\n                        }\n                    },\n                    {\n                        type: 'selection',\n                        width: 60,\n                        align: 'center'\n                    },\n                    {\n                        title: '商品ID',\n                        key: 'id',\n                        width: 80\n                    },\n                    {\n                        title: '商品图',\n                        slot: 'image',\n                        minWidth: 80\n                    },\n                    {\n                        title: '商品名称',\n                        key: 'store_name',\n                        minWidth: 250\n                    },\n                    {\n                        title: '商品售价',\n                        key: 'price',\n                        minWidth: 90\n                    },\n                    {\n                        title: '销量',\n                        key: 'sales',\n                        sortable: true,\n                        minWidth: 90\n                    },\n                    {\n                        title: '库存',\n                        key: 'stock',\n                        minWidth: 80\n                    },\n                    {\n                        title: '排序',\n                        key: 'sort',\n                        minWidth: 70\n                    },\n                    {\n                        title: '状态',\n                        slot: 'state',\n                        width: 100,\n                        filters: [\n                            {\n                                label: '上架',\n                                value: 1\n                            },\n                            {\n                                label: '下架',\n                                value: 0\n                            }\n                        ],\n                        filterMethod (value, row) {\n                            return row.is_show === value\n                        },\n                        filterMultiple: false\n                    },\n                    {\n                        title: '操作',\n                        slot: 'action',\n                        fixed: 'right',\n                        minWidth: 220\n                    }\n                ],\n                data: [],\n                total: 0,\n                attrTemplate: false,\n                ids: []\n            }\n        },\n        watch: {\n          $route(){\n            if(this.$route.fullPath==='/admin/product/product_list?type=5'){\n              this.getPath();\n            }\n          }\n        },\n        created(){\n\n        },\n        mounted () {\n            this.goodHeade()\n            this.goodsCategory()\n            if(this.$route.fullPath==='/admin/product/product_list?type=5'){\n              this.getPath()\n            }else {\n              this.getDataList()\n            }\n        },\n        methods: {\n          getPath(){\n            this.columns2 = [...this.columns];\n            if (name !== '1' && name !== '2') {\n              this.columns2.shift({\n                type: 'selection',\n                width: 60,\n                align: 'center'\n              })\n            }\n            this.artFrom.page = 1;\n            this.artFrom.type = this.$route.query.type.toString();\n            this.getDataList();\n          },\n            // 导出\n            exports () {\n                let formValidate = this.artFrom\n                let data = {\n                    cate_id: formValidate.cate_id,\n                    type: formValidate.type,\n                    store_name: formValidate.store_name\n                }\n                storeProductApi(data).then(res => {\n                    location.href = res.data[0]\n                }).catch(res => {\n                    this.$Message.error(res.msg)\n                })\n            },\n            changeTemplate (e) {\n                // this.template = e;\n            },\n            freight () {\n                this.$refs.template.isTemplate = true\n            },\n            // 批量上架\n            onShelves () {\n                if (this.ids.length === 0) {\n                    this.$Message.warning('请选择要上架的商品')\n                } else {\n                    let data = {\n                        ids: this.ids\n                    }\n                    productShowApi(data).then(res => {\n                        this.$Message.success(res.msg)\n                        this.goodHeade()\n                        this.getDataList()\n                    }).catch(res => {\n                        this.$Message.error(res.msg)\n                    })\n                }\n            },\n            // 批量下架\n            onDismount () {\n                if (this.ids.length === 0) {\n                    this.$Message.warning('请选择要下架的商品')\n                } else {\n                    let data = {\n                        ids: this.ids\n                    }\n                    productUnshowApi(data).then(res => {\n                        this.$Message.success(res.msg)\n                        this.goodHeade()\n                        this.getDataList()\n                    }).catch(res => {\n                        this.$Message.error(res.msg)\n                    })\n                }\n            },\n            // 全选\n            onSelectTab (selection) {\n                let data = []\n                selection.map((item) => {\n                    data.push(item.id)\n                })\n                this.ids = data\n            },\n            // 添加淘宝商品成功\n            onClose () {\n                this.modals = false\n            },\n            // 复制淘宝\n            onCopy () {\n                this.modals = true\n            },\n            // tab选择\n            onClickTab (name) {\n                this.artFrom.type = name\n                this.columns2 = [...this.columns]\n                if (name !== '1' && name !== '2') {\n                    this.columns2.shift({\n                        type: 'selection',\n                        width: 60,\n                        align: 'center'\n                    })\n                }\n                this.artFrom.page = 1\n                this.getDataList()\n            },\n            // 下拉树\n            handleCheckChange (data) {\n                let value = ''\n                let title = ''\n                this.list = []\n                this.artFrom.cate_id = 0\n                data.forEach((item, index) => {\n                    value += `${item.id},`\n                    title += `${item.title},`\n                })\n                value = value.substring(0, value.length - 1)\n                title = title.substring(0, title.length - 1)\n                this.list.push({\n                    value,\n                    title\n                })\n                this.artFrom.cate_id = value\n                this.getDataList()\n            },\n            // 获取商品表单头数量\n            goodHeade () {\n                getGoodHeade().then(res => {\n                    this.headeNum = res.data.list\n                }).catch(res => {\n                    this.$Message.error(res.msg)\n                })\n            },\n            // 商品分类；\n            goodsCategory () {\n                treeListApi(1).then(res => {\n                    this.treeSelect = res.data\n                }).catch(res => {\n                    this.$Message.error(res.msg)\n                })\n            },\n            // 商品列表；\n            getDataList () {\n                this.loading = true\n                this.artFrom.cate_id = this.artFrom.cate_id || ''\n                getGoods(this.artFrom).then(res => {\n                    let data = res.data\n                    this.tableList = data.list\n                    this.total = res.data.count\n                    this.loading = false\n                }).catch(res => {\n                    this.loading = false\n                    this.$Message.error(res.msg)\n                })\n            },\n            pageChange (status) {\n                this.artFrom.page = status\n                this.getDataList()\n            },\n            // 表格搜索\n            userSearchs () {\n                this.artFrom.page = 1\n                this.getDataList()\n            },\n            // 上下架\n            changeSwitch (row) {\n                PostgoodsIsShow(row.id, row.is_show).then(res => {\n                    this.$Message.success(res.msg)\n                    this.goodHeade()\n                    this.getDataList()\n                }).catch(res => {\n                    this.$Message.error(res.msg)\n                })\n            },\n            // 数据导出；\n            exportData: function () {\n                let th = ['商品名称', '商品简介', '商品分类', '价格', '库存', '销量', '收藏人数']\n                let filterVal = ['store_name', 'store_info', 'cate_name', 'price', 'stock', 'sales', 'collect']\n                this.where.page = 'nopage'\n                getGoods(this.where).then(res => {\n                    let data = res.data.map(v => filterVal.map(k => v[k]))\n                    let fileTime = Date.parse(new Date())\n                    let [fileName, fileType, sheetName] = ['商户数据_' + fileTime, 'xlsx', '商户数据']\n                    toExcel({ th, data, fileName, fileType, sheetName })\n                })\n            },\n            // 属性弹出；\n            attrTap () {\n                this.attrTemplate = true\n            },\n            changeTemplate (msg) {\n                this.attrTemplate = msg\n            },\n            // 编辑\n            edit (row) {\n                this.$router.push({ path: '/admin/product/add_product/' + row.id })\n            },\n            // 确认\n            del (row, tit, num) {\n                let delfromData = {\n                    title: tit,\n                    num: num,\n                    url: `product/product/${row.id}`,\n                    method: 'DELETE',\n                    ids: ''\n                }\n                this.$modalSure(delfromData).then((res) => {\n                    this.$Message.success(res.msg)\n                    this.tableList.splice(num, 1)\n                    this.goodHeade()\n                }).catch(res => {\n                    this.$Message.error(res.msg)\n                })\n            }\n            // 删除成功\n            // submitModel () {\n            //     this.tableList.splice(this.delfromData.num, 1);\n            //     this.goodHeade();\n            // }\n        }\n    }\n</script>\n<style scoped lang=\"stylus\">\n  /deep/.ivu-modal-mask\n    z-index 999!important;\n  /deep/.ivu-modal-wrap\n    z-index 999!important;\n  .Box\n    >>> .ivu-modal-body\n      height 700px\n      overflow: auto;\n  .tabBox_img\n    width 36px\n    height 36px\n    border-radius:4px\n    cursor pointer\n    img\n      width 100%\n      height 100%\n</style>\n"]}]}