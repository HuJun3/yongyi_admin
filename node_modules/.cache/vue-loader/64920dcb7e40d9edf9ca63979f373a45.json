{"remainingRequest":"/Users/hujun/Downloads/永益科技后端/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/hujun/Downloads/永益科技后端/src/pages/marketing/storeCouponIssue/create.vue?vue&type=style&index=0&id=0b90723c&scoped=true&lang=css&","dependencies":[{"path":"/Users/hujun/Downloads/永益科技后端/src/pages/marketing/storeCouponIssue/create.vue","mtime":1610587844000},{"path":"/Users/hujun/Downloads/永益科技后端/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hujun/Downloads/永益科技后端/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/hujun/Downloads/永益科技后端/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/hujun/Downloads/永益科技后端/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hujun/Downloads/永益科技后端/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgouaW5mb3sKICAgIGNvbG9yOiAjODg4OwogICAgZm9udC1zaXplOiAxMnB4Owp9Ci5pdnUtZm9ybSA+Pj4gLml2dS1mb3JtLWl0ZW0tbGFiZWwgewogICAgZm9udC13ZWlnaHQ6IDcwMDsKICAgIGZvbnQtc2l6ZTogMTRweCAhaW1wb3J0YW50Owp9CgouaXZ1LWlucHV0LXdyYXBwZXIgewogICAgd2lkdGg6IDMyMHB4Owp9CgouaXZ1LXJhZGlvLXdyYXBwZXIgewogICAgbWFyZ2luLXJpZ2h0OiAzMHB4OwogICAgZm9udC1zaXplOiAxNHB4ICFpbXBvcnRhbnQ7Cn0KCi5pdnUtcmFkaW8td3JhcHBlciA+Pj4gLml2dS1yYWRpbyB7CiAgICBtYXJnaW4tcmlnaHQ6IDEwcHg7Cn0KCi5pdnUtaW5wdXQtbnVtYmVyIHsKICAgIHdpZHRoOiAxNjBweDsKfQoKLml2dS1kYXRlLXBpY2tlciB7CiAgICB3aWR0aDogMzIwcHg7Cn0KCi5pdnUtaWNvbi1pb3MtY2FtZXJhLW91dGxpbmUgewogICAgd2lkdGg6IDU4cHg7CiAgICBoZWlnaHQ6IDU4cHg7CiAgICBib3JkZXI6IDFweCBkb3R0ZWQgcmdiYSgwLCAwLCAwLCAwLjEpOwogICAgYm9yZGVyLXJhZGl1czogNHB4OwogICAgYmFja2dyb3VuZC1jb2xvcjogcmdiYSgwLCAwLCAwLCAwLjAyKTsKICAgIGxpbmUtaGVpZ2h0OiA1OHB4OwogICAgY3Vyc29yOiBwb2ludGVyOwogICAgdmVydGljYWwtYWxpZ246IG1pZGRsZTsKfQoKLnVwbG9hZC1saXN0IHsKICAgIHdpZHRoOiA1OHB4OwogICAgaGVpZ2h0OiA1OHB4OwogICAgYm9yZGVyOiAxcHggZG90dGVkIHJnYmEoMCwgMCwgMCwgMC4xKTsKICAgIGJvcmRlci1yYWRpdXM6IDRweDsKICAgIG1hcmdpbi1yaWdodDogMTVweDsKICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsKICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsKICAgIGN1cnNvcjogcG9pbnRlcjsKICAgIHZlcnRpY2FsLWFsaWduOiBtaWRkbGU7Cn0KCi51cGxvYWQtbGlzdCBpbWcgewogICAgZGlzcGxheTogYmxvY2s7CiAgICB3aWR0aDogMTAwJTsKICAgIGhlaWdodDogMTAwJTsKfQoKLml2dS1pY29uLWlvcy1jbG9zZS1jaXJjbGUgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgdG9wOiAwOwogICAgcmlnaHQ6IDA7CiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZSg1MCUsIC01MCUpOwp9Cg=="},{"version":3,"sources":["create.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2YA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA","file":"create.vue","sourceRoot":"src/pages/marketing/storeCouponIssue","sourcesContent":["<template>\n    <div>\n        <div class=\"i-layout-page-header\">\n            <div class=\"i-layout-page-header\">\n                <router-link :to=\"{ path: '/admin/marketing/store_coupon_issue/index' }\"\n                    ><Button icon=\"ios-arrow-back\" size=\"small\" class=\"mr20\"\n                        >返回</Button\n                    ></router-link\n                >\n                <span\n                    class=\"ivu-page-header-title mr20\"\n                    v-text=\"$route.params.id ? '编辑优惠券' : '添加优惠券'\"\n                ></span>\n            </div>\n        </div>\n        <Card :bordered=\"false\" dis-hover class=\"ivu-mt\">\n            <Form :model=\"formData\" :label-width=\"150\">\n                <FormItem label=\"优惠券名称\">\n                    <Input v-model=\"formData.coupon_title\" placeholder=\"请输入优惠券名称\"></Input>\n                </FormItem>\n                <FormItem label=\"发送方式\">\n                    <RadioGroup v-model=\"formData.receive_type\">\n                        <Radio :label=\"1\">手动领取</Radio>\n                        <Radio :label=\"2\">新人券</Radio>\n                        <Radio :label=\"3\">赠送券</Radio>\n                    </RadioGroup>\n                </FormItem>\n                <FormItem label=\"优惠劵类型\">\n                    <RadioGroup v-model=\"formData.type\">\n                        <Radio :label=\"0\">通用券</Radio>\n                        <Radio :label=\"1\">品类券</Radio>\n                        <Radio :label=\"2\">商品券</Radio>\n                    </RadioGroup>\n                </FormItem>\n                <FormItem v-show=\"formData.type === 2\">\n                    <template>\n                        <div class=\"upload-list\" v-for=\"item in productList\" :key=\"item.product_id\">\n                            <img :src=\"item.image\" />\n                            <Icon\n                                type=\"ios-close-circle\"\n                                size=\"16\"\n                                @click=\"remove(item.product_id)\"\n                            />\n                        </div>\n                    </template>\n                    <Icon type=\"ios-camera-outline\" size=\"26\" @click=\"modals = true\" />\n                    <div class=\"info\">选择商品</div>\n                </FormItem>\n                <FormItem v-show=\"formData.type === 1\">\n                    <Select v-model=\"formData.category_id\" style=\"width: 320px\">\n                        <Option v-for=\"item in categoryList\" :value=\"item.id\" :key=\"item.id\">{{\n                            item.cate_name\n                        }}</Option>\n                    </Select>\n                    <div class=\"info\">选择商品的品类</div>\n                </FormItem>\n                <FormItem label=\"优惠券面值\">\n                    <InputNumber\n                        :min=\"1\"\n                        :max=\"100000000\"\n                        v-model=\"formData.coupon_price\"\n                    ></InputNumber>\n                </FormItem>\n                <FormItem label=\"使用门槛\">\n                    <RadioGroup v-model=\"isMinPrice\">\n                        <Radio :label=\"0\">无门槛</Radio>\n                        <Radio :label=\"1\">有门槛</Radio>\n                    </RadioGroup>\n                </FormItem>\n                <FormItem v-show=\"isMinPrice\">\n                    <InputNumber\n                        :min=\"1\"\n                        :max=\"100000000\"\n                        v-model=\"formData.use_min_price\"\n                    ></InputNumber>\n                    <div class=\"info\">填写优惠券的最低消费金额</div>\n                </FormItem>\n                <FormItem label=\"使用时间\">\n                    <RadioGroup v-model=\"isCouponTime\">\n                        <Radio :label=\"1\">天数</Radio>\n                        <Radio :label=\"0\">时间段</Radio>\n                    </RadioGroup>\n                </FormItem>\n                <FormItem v-show=\"isCouponTime\" label=\"\">\n                    <InputNumber\n                        :min=\"1\"\n                        v-model=\"formData.coupon_time\"\n                        :precision=\"0\"\n                    ></InputNumber>\n                    <div class=\"info\">领取后多少天内有效</div>\n                </FormItem>\n                <FormItem v-show=\"!isCouponTime\" label=\"\">\n                    <DatePicker\n                        :value=\"datetime1\"\n                        :editable=\"false\"\n                        type=\"datetimerange\"\n                        placeholder=\"领取后在这个时间段内可以使用\"\n                        @on-change=\"dateChange\"\n                    ></DatePicker>\n                </FormItem>\n                <FormItem label=\"领取时间\">\n                    <RadioGroup v-model=\"isReceiveTime\">\n                        <Radio :label=\"1\">限时</Radio>\n                        <Radio :label=\"0\">不限时</Radio>\n                    </RadioGroup>\n                </FormItem>\n                <FormItem v-show=\"isReceiveTime\" label=\"\">\n                    <DatePicker\n                        :value=\"datetime2\"\n                        type=\"datetimerange\"\n                        placeholder=\"在这个时间段内可领取\"\n                        @on-change=\"timeChange\"\n                    ></DatePicker>\n                </FormItem>\n                <FormItem label=\"是否限量\">\n                    <RadioGroup v-model=\"formData.is_permanent\">\n                        <Radio :label=\"0\">限量</Radio>\n                        <Radio :label=\"1\">不限量</Radio>\n                    </RadioGroup>\n                </FormItem>\n                <FormItem v-show=\"!formData.is_permanent\" label=\"\">\n                    <InputNumber\n                        :min=\"1\"\n                        :max=\"100000000\"\n                        v-model=\"formData.total_count\"\n                        :precision=\"0\"\n                    ></InputNumber>\n                    <div class=\"info\">填写优惠券的发布数量</div>\n                </FormItem>\n<!--                <FormItem label=\"排序\">-->\n<!--                    <InputNumber-->\n<!--                        :min=\"0\"-->\n<!--                        :max=\"100000000\"-->\n<!--                        v-model=\"formData.sort\"-->\n<!--                        :precision=\"0\"-->\n<!--                    ></InputNumber>-->\n<!--                </FormItem>-->\n                <FormItem label=\"状态\">\n                    <RadioGroup v-model=\"formData.status\">\n                        <Radio :label=\"1\">开启</Radio>\n                        <Radio :label=\"0\">关闭</Radio>\n                    </RadioGroup>\n                </FormItem>\n                <FormItem>\n                    <Button type=\"primary\" @click=\"save\" :disabled=\"disabled\">立即创建</Button>\n                </FormItem>\n            </Form>\n        </Card>\n        <Modal\n            v-model=\"modals\"\n            title=\"商品列表\"\n            footerHide\n            class=\"paymentFooter\"\n            scrollable\n            width=\"900\"\n            @on-cancel=\"cancel\"\n        >\n            <goods-list\n                ref=\"goodslist\"\n                v-if=\"modals\"\n                :ischeckbox=\"true\"\n                @getProductId=\"getProductId\"\n            ></goods-list>\n        </Modal>\n    </div>\n</template>\n\n<script>\nimport { mapState } from \"vuex\";\nimport goodsList from \"@/components/goodsList/index\";\nimport { couponCategoryApi, couponSaveApi, couponDetailApi } from \"@/api/marketing\";\nexport default {\n    name: \"storeCouponCreate\",\n    components: {\n        goodsList\n    },\n    data() {\n        return {\n            disabled: false,\n            formData: {\n                coupon_title: \"\",\n                coupon_price: 0,\n                type: 0,\n                use_min_price: 0,\n                coupon_time: 1,\n                start_use_time: 0,\n                end_use_time: 0,\n                start_time: 0,\n                end_time: 0,\n                receive_type: 1,\n                is_permanent: 1,\n                total_count: 1,\n                sort: 0,\n                status: 1,\n                product_id: \"\",\n                category_id: 0\n            },\n            categoryList: [],\n            productList: [],\n            isMinPrice: 0,\n            isCouponTime: 1,\n            isReceiveTime: 0,\n            modals: false,\n            datetime1: [],\n            datetime2: []\n        };\n    },\n    computed: {\n        ...mapState(\"media\", [\"isMobile\"])\n    },\n    created() {\n        this.getCategoryList();\n        if (this.$route.params.id) {\n            this.getCouponDetail();\n        }\n    },\n    methods: {\n        // 品类\n        getCategoryList() {\n            couponCategoryApi(1).then(async res => {\n                res.data.forEach(val => {\n                    val.cate_name = `${val.html}${val.cate_name}`;\n                });\n                this.categoryList = res.data;\n            });\n        },\n        // 优惠券\n        getCouponDetail() {\n            couponDetailApi(this.$route.params.id)\n                .then(res => {\n                    let data = res.data;\n                    this.formData.coupon_title = data.coupon_title;\n                    this.formData.type = data.type;\n                    this.formData.category_id = data.category_id;\n                    this.formData.coupon_price = parseFloat(data.coupon_price);\n                    this.formData.use_min_price = parseFloat(data.use_min_price);\n                    this.formData.coupon_time = data.coupon_time;\n                    this.formData.receive_type = data.receive_type;\n                    this.formData.is_permanent = data.is_permanent;\n                    this.formData.status = data.status;\n                    this.formData.product_id = data.product_id;\n                    this.formData.start_time = data.start_time;\n                    this.formData.end_time = data.end_time;\n                    this.formData.total_count = data.total_count;\n                    this.formData.sort = data.sort;\n                    if (\"productInfo\" in data) {\n                        this.productList = data.productInfo;\n                    }\n                    if (!data.coupon_time) {\n                        this.isCouponTime = 0;\n                        this.datetime1 = [data.start_use_time * 1000, data.end_use_time * 1000];\n                        this.formData.start_use_time = this.makeDate(data.start_use_time * 1000);\n                        this.formData.end_use_time = this.makeDate(data.end_use_time * 1000);\n                    }\n                    if (data.start_time) {\n                        this.isReceiveTime = 1;\n                        this.datetime2 = [data.start_time * 1000, data.end_time * 1000];\n                        this.formData.start_time = this.makeDate(data.start_time * 1000);\n                        this.formData.end_time = this.makeDate(data.end_time * 1000);\n                    }\n                })\n                .catch(err => {\n                    this.$Message.error(err.msg);\n                });\n        },\n        makeDate(data){\n            let date = new Date(data);\n            let YY = date.getFullYear() + '-';\n            let MM = (date.getMonth() + 1 < 10 ? '0' + (date.getMonth() + 1) : date.getMonth() + 1) + '-';\n            let DD = (date.getDate() < 10 ? '0' + (date.getDate()) : date.getDate());\n            let hh = (date.getHours() < 10 ? '0' + date.getHours() : date.getHours()) + ':';\n            let mm = (date.getMinutes() < 10 ? '0' + date.getMinutes() : date.getMinutes()) + ':';\n            let ss = (date.getSeconds() < 10 ? '0' + date.getSeconds() : date.getSeconds());\n            return YY + MM + DD +\" \"+hh + mm + ss;\n        },\n        // 创建\n        save() {\n            if (!this.formData.coupon_title) {\n                return this.$Message.error(\"请输入优惠券名称\");\n            }\n            if (this.formData.type === 2) {\n                if (!this.formData.product_id) {\n                    return this.$Message.error(\"请选择商品\");\n                }\n            }\n            if (this.formData.type === 1) {\n                if (!this.formData.category_id) {\n                    return this.$Message.error(\"请选择品类\");\n                }\n            }\n            if (this.formData.coupon_price <= 0) {\n                return this.$Message.error(\"优惠券面值不能小于0\");\n            }\n            if (!this.isMinPrice) {\n                this.formData.use_min_price = 0;\n            } else {\n                if (this.formData.use_min_price < 1) {\n                    return this.$Message.error(\"优惠券最低消费不能小于0\");\n                }\n            }\n            if (this.isCouponTime) {\n                this.formData.start_use_time = 0;\n                this.formData.end_use_time = 0;\n                if (this.formData.coupon_time < 1) {\n                    return this.$Message.error(\"使用有效期限不能小于1天\");\n                }\n            } else {\n                this.formData.coupon_time = 0;\n                if (!this.formData.start_use_time) {\n                    return this.$Message.error(\"请选择使用有效期限\");\n                }\n            }\n            if (this.isReceiveTime) {\n                if (!this.formData.start_time) {\n                    return this.$Message.error(\"请选择领取时间\");\n                }\n            } else {\n                this.formData.start_time = 0;\n                this.formData.end_time = 0;\n            }\n            if (this.formData.is_permanent) {\n                console.log(456);\n                this.formData.total_count = 0;\n            } else {\n                if (this.formData.total_count < 1) {\n                    return this.$Message.error(\"发布数量不能小于1\");\n                }\n            }\n            this.disabled = false;\n            couponSaveApi(this.formData)\n                .then(res => {\n                    this.disabled = true;\n                    this.$Message.success(res.msg);\n                    setTimeout(() => {\n                        this.$router.push({\n                            path: \"/admin/marketing/store_coupon_issue/index\"\n                        });\n                    }, 1000);\n                })\n                .catch(err => {\n                    this.$Message.error(err.msg);\n                });\n        },\n        // 使用有效期--时间段\n        dateChange(time) {\n            this.formData.start_use_time = time[0];\n            this.formData.end_use_time = time[1];\n        },\n        // 限时\n        timeChange(time) {\n            this.formData.start_time = time[0];\n            this.formData.end_time = time[1];\n        },\n        //对象数组去重；\n        unique(arr) {\n            const res = new Map();\n            return arr.filter((arr) => !res.has(arr.product_id) && res.set(arr.product_id, 1))\n        },\n        // 选择的商品\n        getProductId(productList) {\n            this.modals = false;\n            this.productList = this.unique(this.productList.concat(productList));\n            this.formData.product_id = \"\";\n            this.productList.forEach(value => {\n                if (this.formData.product_id) {\n                    this.formData.product_id += `,${value.product_id}`;\n                } else {\n                    this.formData.product_id += `${value.product_id}`;\n                }\n            });\n        },\n        cancel() {\n            this.modals = false;\n        },\n        // 删除商品\n        remove(productId) {\n            for (let index = 0; index < this.productList.length; index++) {\n                if (this.productList[index].product_id == productId) {\n                    this.productList.splice(index, 1);\n                }\n            }\n            this.formData.product_id = \"\";\n            this.productList.forEach(value => {\n                if (this.formData.product_id) {\n                    this.formData.product_id += `,${value.product_id}`;\n                } else {\n                    this.formData.product_id += `${value.product_id}`;\n                }\n            });\n        }\n    }\n};\n</script>\n\n<style scoped>\n.info{\n    color: #888;\n    font-size: 12px;\n}\n.ivu-form >>> .ivu-form-item-label {\n    font-weight: 700;\n    font-size: 14px !important;\n}\n\n.ivu-input-wrapper {\n    width: 320px;\n}\n\n.ivu-radio-wrapper {\n    margin-right: 30px;\n    font-size: 14px !important;\n}\n\n.ivu-radio-wrapper >>> .ivu-radio {\n    margin-right: 10px;\n}\n\n.ivu-input-number {\n    width: 160px;\n}\n\n.ivu-date-picker {\n    width: 320px;\n}\n\n.ivu-icon-ios-camera-outline {\n    width: 58px;\n    height: 58px;\n    border: 1px dotted rgba(0, 0, 0, 0.1);\n    border-radius: 4px;\n    background-color: rgba(0, 0, 0, 0.02);\n    line-height: 58px;\n    cursor: pointer;\n    vertical-align: middle;\n}\n\n.upload-list {\n    width: 58px;\n    height: 58px;\n    border: 1px dotted rgba(0, 0, 0, 0.1);\n    border-radius: 4px;\n    margin-right: 15px;\n    display: inline-block;\n    position: relative;\n    cursor: pointer;\n    vertical-align: middle;\n}\n\n.upload-list img {\n    display: block;\n    width: 100%;\n    height: 100%;\n}\n\n.ivu-icon-ios-close-circle {\n    position: absolute;\n    top: 0;\n    right: 0;\n    transform: translate(50%, -50%);\n}\n</style>\n"]}]}