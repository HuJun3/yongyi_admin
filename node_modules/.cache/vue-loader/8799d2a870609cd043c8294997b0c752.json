{"remainingRequest":"/Users/hujun/Downloads/永益科技后端/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/hujun/Downloads/永益科技后端/src/pages/product/productAttr/addAttr.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/hujun/Downloads/永益科技后端/src/pages/product/productAttr/addAttr.vue","mtime":1610587844000},{"path":"/Users/hujun/Downloads/永益科技后端/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hujun/Downloads/永益科技后端/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/hujun/Downloads/永益科技后端/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hujun/Downloads/永益科技后端/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IG1hcFN0YXRlIH0gZnJvbSAndnVleCcKaW1wb3J0IHsgcnVsZUFkZEFwaSwgcnVsZUluZm9BcGkgfSBmcm9tICdAL2FwaS9wcm9kdWN0JwpleHBvcnQgZGVmYXVsdCB7CiAgICBuYW1lOiAnYWRkQXR0cicsCiAgICBkYXRhICgpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBzcGluU2hvdzogZmFsc2UsCiAgICAgICAgICAgIG1vZGFsX2xvYWRpbmc6IGZhbHNlLAogICAgICAgICAgICBncmlkOiB7CiAgICAgICAgICAgICAgICB4bDogMywKICAgICAgICAgICAgICAgIGxnOiAzLAogICAgICAgICAgICAgICAgbWQ6IDEyLAogICAgICAgICAgICAgICAgc206IDI0LAogICAgICAgICAgICAgICAgeHM6IDI0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICAgICAgaW5kZXg6IDEsCiAgICAgICAgICAgIHJ1bGVzOiB7CiAgICAgICAgICAgICAgICBydWxlX25hbWU6IFsKICAgICAgICAgICAgICAgICAgICB7IHJlcXVpcmVkOiB0cnVlLCBtZXNzYWdlOiAn6K+36L6T5YWl6KeE5qC85ZCN56ewJywgdHJpZ2dlcjogJ2JsdXInIH0KICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgZm9ybUR5bmFtaWM6IHsKICAgICAgICAgICAgICAgIHJ1bGVfbmFtZTogJycsCiAgICAgICAgICAgICAgICBzcGVjOiBbXQogICAgICAgICAgICB9LAogICAgICAgICAgICBhdHRyc05hbWU6ICcnLAogICAgICAgICAgICBhdHRyc1ZhbDogJycsCiAgICAgICAgICAgIGZvcm1EeW5hbWljTmFtZURhdGE6IFtdLAogICAgICAgICAgICBpc0J0bjogZmFsc2UsCiAgICAgICAgICAgIGZvcm1EeW5hbWljTmFtZTogW10sCiAgICAgICAgICAgIHJlc3VsdHM6IFtdLAogICAgICAgICAgICByZXN1bHQ6IFtdLAogICAgICAgICAgICBpZHM6IDAKICAgICAgICB9CiAgICB9LAogICAgY29tcHV0ZWQ6IHsKICAgIH0sCiAgICBtZXRob2RzOiB7CiAgICAgICAgb25DYW5jZWwgKCkgewogICAgICAgICAgICB0aGlzLmNsZWFyKCkKICAgICAgICB9LAogICAgICAgIC8vIOa3u+WKoOaMiemSrgogICAgICAgIGFkZEJ0biAoKSB7CiAgICAgICAgICAgIHRoaXMuaXNCdG4gPSB0cnVlCiAgICAgICAgfSwKICAgICAgICAvLyDor6bmg4UKICAgICAgICBnZXRJb2ZvIChyb3cpIHsKICAgICAgICAgICAgdGhpcy5zcGluU2hvdyA9IHRydWUKICAgICAgICAgICAgdGhpcy5pZHMgPSByb3cuaWQKICAgICAgICAgICAgcnVsZUluZm9BcGkocm93LmlkKS50aGVuKHJlcyA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLmZvcm1EeW5hbWljID0gcmVzLmRhdGEuaW5mbwogICAgICAgICAgICAgICAgdGhpcy5zcGluU2hvdyA9IGZhbHNlCiAgICAgICAgICAgIH0pLmNhdGNoKHJlcyA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLnNwaW5TaG93ID0gZmFsc2UKICAgICAgICAgICAgICAgIHRoaXMuJE1lc3NhZ2UuZXJyb3IocmVzLm1zZykKICAgICAgICAgICAgfSkKICAgICAgICB9LAogICAgICAgIC8vIOaPkOS6pAogICAgICAgIGhhbmRsZVN1Ym1pdCAobmFtZSkgewogICAgICAgICAgICB0aGlzLiRyZWZzW25hbWVdLnZhbGlkYXRlKCh2YWxpZCkgPT4gewogICAgICAgICAgICAgICAgaWYgKHZhbGlkKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZm9ybUR5bmFtaWMuc3BlYy5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJE1lc3NhZ2Uud2FybmluZygn6K+36Iez5bCR5re75Yqg5LiA5p2h5ZWG5ZOB6KeE5qC877yBJykKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RhbF9sb2FkaW5nID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBydWxlQWRkQXBpKHRoaXMuZm9ybUR5bmFtaWMsIHRoaXMuaWRzKS50aGVuKHJlcyA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRNZXNzYWdlLnN1Y2Nlc3MocmVzLm1zZykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW9kYWwgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW9kYWxfbG9hZGluZyA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCA1MDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbWl0KCdnZXRMaXN0JykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNsZWFyKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIDYwMCkKICAgICAgICAgICAgICAgICAgICAgICAgfSkuY2F0Y2gocmVzID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW9kYWxfbG9hZGluZyA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRNZXNzYWdlLmVycm9yKHJlcy5tc2cpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgfSwgMTIwMCkKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgfSwKICAgICAgICBjbGVhciAoKSB7CiAgICAgICAgICAgIHRoaXMuJHJlZnNbJ2Zvcm1EeW5hbWljJ10ucmVzZXRGaWVsZHMoKQogICAgICAgICAgICB0aGlzLmZvcm1EeW5hbWljLnNwZWMgPSBbXQogICAgICAgICAgICB0aGlzLmlzQnRuID0gZmFsc2UKICAgICAgICAgICAgdGhpcy5hdHRyc05hbWUgPSAnJwogICAgICAgICAgICB0aGlzLmF0dHJzVmFsID0gJycKICAgICAgICB9LAogICAgICAgIC8vIOWPlua2iAogICAgICAgIG9mZkF0dHJOYW1lICgpIHsKICAgICAgICAgICAgdGhpcy5pc0J0biA9IGZhbHNlCiAgICAgICAgfSwKICAgICAgICAvLyDliKDpmaQKICAgICAgICBoYW5kbGVSZW1vdmUgKGluZGV4KSB7CiAgICAgICAgICAgIHRoaXMuZm9ybUR5bmFtaWMuc3BlYy5zcGxpY2UoaW5kZXgsIDEpCiAgICAgICAgfSwKICAgICAgICAvLyDliKDpmaTlsZ7mgKcKICAgICAgICBoYW5kbGVSZW1vdmUyIChpdGVtLCBpbmRleCkgewogICAgICAgICAgICBpdGVtLnNwbGljZShpbmRleCwgMSkKICAgICAgICB9LAogICAgICAgIC8vIOa3u+WKoOinhOWImeWQjeensAogICAgICAgIGNyZWF0ZUF0dHJOYW1lICgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuYXR0cnNOYW1lICYmIHRoaXMuYXR0cnNWYWwpIHsKICAgICAgICAgICAgICAgIGxldCBkYXRhID0gewogICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLmF0dHJzTmFtZSwKICAgICAgICAgICAgICAgICAgICBkZXRhaWw6IFsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hdHRyc1ZhbAogICAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuZm9ybUR5bmFtaWMuc3BlYy5wdXNoKGRhdGEpCiAgICAgICAgICAgICAgICB2YXIgaGFzaCA9IHt9CiAgICAgICAgICAgICAgICB0aGlzLmZvcm1EeW5hbWljLnNwZWMgPSB0aGlzLmZvcm1EeW5hbWljLnNwZWMucmVkdWNlKGZ1bmN0aW9uIChpdGVtLCBuZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgLyogZXNsaW50LWRpc2FibGUgKi8KICAgICAgICAgICAgICAgICAgICBoYXNoW25leHQudmFsdWVdID8gJycgOiBoYXNoW25leHQudmFsdWVdID0gdHJ1ZSAmJiBpdGVtLnB1c2gobmV4dCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0KICAgICAgICAgICAgICAgIH0sIFtdKQogICAgICAgICAgICAgICAgIHRoaXMuYXR0cnNOYW1lID0gJyc7CiAgICAgICAgICAgICAgICAgdGhpcy5hdHRyc1ZhbCA9ICcnOwogICAgICAgICAgICAgICAgdGhpcy5pc0J0biA9IGZhbHNlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy4kTWVzc2FnZS53YXJuaW5nKCfor7fmt7vliqDop4TmoLzlkI3np7DmiJbop4TmoLzlgLwnKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgLy8g5re75Yqg5bGe5oCnCiAgICAgICAgY3JlYXRlQXR0ciAobnVtLCBpZHgpIHsKICAgICAgICAgICAgaWYgKG51bSkgewogICAgICAgICAgICAgICAgdGhpcy5mb3JtRHluYW1pYy5zcGVjW2lkeF0uZGV0YWlsLnB1c2gobnVtKTsKICAgICAgICAgICAgICAgIHZhciBoYXNoID0ge307CiAgICAgICAgICAgICAgICB0aGlzLmZvcm1EeW5hbWljLnNwZWNbaWR4XS5kZXRhaWwgPSB0aGlzLmZvcm1EeW5hbWljLnNwZWNbaWR4XS5kZXRhaWwucmVkdWNlKGZ1bmN0aW9uIChpdGVtLCBuZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgLyogZXNsaW50LWRpc2FibGUgKi8KICAgICAgICAgICAgICAgICAgICBoYXNoW25leHRdID8gJycgOiBoYXNoW25leHRdID0gdHJ1ZSAmJiBpdGVtLnB1c2gobmV4dCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0KICAgICAgICAgICAgICAgIH0sIFtdKQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy4kTWVzc2FnZS53YXJuaW5nKCfor7fmt7vliqDlsZ7mgKcnKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQo="},{"version":3,"sources":["addAttr.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"addAttr.vue","sourceRoot":"src/pages/product/productAttr","sourcesContent":["<template>\n    <Modal\n             scrollable\n            v-model=\"modal\"\n            @on-cancel=\"onCancel\"\n            title=\"添加商品规格\"\n            width=\"950\">\n        <Form  ref=\"formDynamic\" :model=\"formDynamic\" :rules=\"rules\" class=\"attrFrom\" :label-width=\"110\" label-position=\"right\" @submit.native.prevent>\n            <Row :gutter=\"24\">\n                <Col span=\"24\">\n                    <Col span=\"8\" class=\"mb15\">\n                        <FormItem label=\"规格模板名称：\" prop=\"rule_name\">\n                            <Input  placeholder=\"请输入标题名称\" :maxlength=\"20\" v-model=\"formDynamic.rule_name\"  />\n                        </FormItem>\n                    </Col>\n                </Col>\n                <Col span=\"23\" class=\"noForm\"  v-for=\"(item, index) in formDynamic.spec\" :key=\"index\">\n                    <FormItem>\n                        <div class=\"acea-row row-middle\"><span class=\"mr5\">{{item.value}}</span><Icon type=\"ios-close-circle\" @click=\"handleRemove(index)\"/></div>\n                        <div class=\"rulesBox\">\n                            <Tag type=\"dot\" class=\"mb5\" closable color=\"primary\" v-for=\"(j, indexn) in item.detail\" :key=\"indexn\" :name=\"j\"  @on-close=\"handleRemove2(item.detail,indexn)\">{{j}}</Tag>\n                            <Input search enter-button=\"添加\" placeholder=\"请输入属性名称\" v-model=\"item.detail.attrsVal\" @on-search=\"createAttr(item.detail.attrsVal,index)\" style=\"width: 150px\"/>\n                        </div>\n                    </FormItem>\n                </Col>\n                <Col span=\"24\" v-if=\"isBtn\" class=\"mt10\">\n                    <Col span=\"8\" class=\"mr15\">\n                        <FormItem label=\"规格名称：\">\n                            <Input  placeholder=\"请输入规格\" v-model=\"attrsName\"  />\n                        </FormItem>\n                    </Col>\n                    <Col span=\"8\" class=\"mr20\">\n                        <FormItem label=\"规格值：\">\n                            <Input v-model=\"attrsVal\" placeholder=\"请输入规格值\"  />\n                        </FormItem>\n                    </Col>\n                    <Col span=\"2\">\n                        <Button type=\"primary\"  @click=\"createAttrName\">确定</Button>\n                    </Col>\n                    <Col span=\"2\">\n                        <Button  @click=\"offAttrName\">取消</Button>\n                    </Col>\n                </Col>\n                <Spin size=\"large\" fix v-if=\"spinShow\"></Spin>\n            </Row>\n            <Button type=\"primary\" icon=\"md-add\" @click=\"addBtn\" v-if=\"!isBtn\" class=\"ml95 mt10\">添加新规格</Button>\n        </Form>\n        <div slot=\"footer\">\n            <Button type=\"primary\" :loading=\"modal_loading\"   @click=\"handleSubmit('formDynamic')\">确定</Button>\n        </div>\n    </Modal>\n</template>\n\n<script>\n    import { mapState } from 'vuex'\n    import { ruleAddApi, ruleInfoApi } from '@/api/product'\n    export default {\n        name: 'addAttr',\n        data () {\n            return {\n                spinShow: false,\n                modal_loading: false,\n                grid: {\n                    xl: 3,\n                    lg: 3,\n                    md: 12,\n                    sm: 24,\n                    xs: 24\n                },\n                modal: false,\n                index: 1,\n                rules: {\n                    rule_name: [\n                        { required: true, message: '请输入规格名称', trigger: 'blur' }\n                    ]\n                },\n                formDynamic: {\n                    rule_name: '',\n                    spec: []\n                },\n                attrsName: '',\n                attrsVal: '',\n                formDynamicNameData: [],\n                isBtn: false,\n                formDynamicName: [],\n                results: [],\n                result: [],\n                ids: 0\n            }\n        },\n        computed: {\n        },\n        methods: {\n            onCancel () {\n                this.clear()\n            },\n            // 添加按钮\n            addBtn () {\n                this.isBtn = true\n            },\n            // 详情\n            getIofo (row) {\n                this.spinShow = true\n                this.ids = row.id\n                ruleInfoApi(row.id).then(res => {\n                    this.formDynamic = res.data.info\n                    this.spinShow = false\n                }).catch(res => {\n                    this.spinShow = false\n                    this.$Message.error(res.msg)\n                })\n            },\n            // 提交\n            handleSubmit (name) {\n                this.$refs[name].validate((valid) => {\n                    if (valid) {\n                        if (this.formDynamic.spec.length === 0) {\n                            return this.$Message.warning('请至少添加一条商品规格！')\n                        }\n                        this.modal_loading = true\n                        setTimeout(() => {\n                            ruleAddApi(this.formDynamic, this.ids).then(res => {\n                                this.$Message.success(res.msg)\n                                setTimeout(() => {\n                                    this.modal = false\n                                    this.modal_loading = false\n                                }, 500)\n                                setTimeout(() => {\n                                    this.$emit('getList')\n                                    this.clear()\n                                }, 600)\n                            }).catch(res => {\n                                this.modal_loading = false\n                                this.$Message.error(res.msg)\n                            })\n                        }, 1200)\n                    } else {\n                        return false\n                    }\n                })\n            },\n            clear () {\n                this.$refs['formDynamic'].resetFields()\n                this.formDynamic.spec = []\n                this.isBtn = false\n                this.attrsName = ''\n                this.attrsVal = ''\n            },\n            // 取消\n            offAttrName () {\n                this.isBtn = false\n            },\n            // 删除\n            handleRemove (index) {\n                this.formDynamic.spec.splice(index, 1)\n            },\n            // 删除属性\n            handleRemove2 (item, index) {\n                item.splice(index, 1)\n            },\n            // 添加规则名称\n            createAttrName () {\n                if (this.attrsName && this.attrsVal) {\n                    let data = {\n                        value: this.attrsName,\n                        detail: [\n                            this.attrsVal\n                        ]\n                    }\n                    this.formDynamic.spec.push(data)\n                    var hash = {}\n                    this.formDynamic.spec = this.formDynamic.spec.reduce(function (item, next) {\n                        /* eslint-disable */\n                        hash[next.value] ? '' : hash[next.value] = true && item.push(next);\n                        return item\n                    }, [])\n                     this.attrsName = '';\n                     this.attrsVal = '';\n                    this.isBtn = false;\n                } else {\n                    this.$Message.warning('请添加规格名称或规格值');\n                }\n            },\n            // 添加属性\n            createAttr (num, idx) {\n                if (num) {\n                    this.formDynamic.spec[idx].detail.push(num);\n                    var hash = {};\n                    this.formDynamic.spec[idx].detail = this.formDynamic.spec[idx].detail.reduce(function (item, next) {\n                        /* eslint-disable */\n                        hash[next] ? '' : hash[next] = true && item.push(next);\n                        return item\n                    }, [])\n                } else {\n                    this.$Message.warning('请添加属性');\n                }\n            }\n        }\n    }\n</script>\n\n<style scoped lang=\"stylus\">\n    .rulesBox\n        display flex\n        flex-wrap: wrap;\n    .attrFrom\n        >>> .ivu-form-item\n         margin-bottom 0px !important\n</style>\n"]}]}