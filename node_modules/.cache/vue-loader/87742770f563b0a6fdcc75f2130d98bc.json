{"remainingRequest":"/Users/hujun/Downloads/永益科技后端/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/hujun/Downloads/永益科技后端/src/pages/kefu/pc/components/delivery.vue?vue&type=style&index=0&id=40ab68fa&lang=stylus&scoped=true&","dependencies":[{"path":"/Users/hujun/Downloads/永益科技后端/src/pages/kefu/pc/components/delivery.vue","mtime":1610680940000},{"path":"/Users/hujun/Downloads/永益科技后端/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hujun/Downloads/永益科技后端/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/hujun/Downloads/永益科技后端/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/hujun/Downloads/永益科技后端/node_modules/stylus-loader/index.js","mtime":1519606876000},{"path":"/Users/hujun/Downloads/永益科技后端/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hujun/Downloads/永益科技后端/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKLmZvcm0taXRlbQogICAgd2lkdGggMTAwJQo="},{"version":3,"sources":["delivery.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsSA;AACA","file":"delivery.vue","sourceRoot":"src/pages/kefu/pc/components","sourcesContent":["<template>\n    <div>\n        <Form ref=\"formValidate\" :model=\"formValidate\" :rules=\"ruleInline\" inline>\n            <FormItem label=\"选择类型：\" class=\"form-item\" label-position=\"right\" :label-width=\"100\">\n                <RadioGroup v-model=\"formValidate.gender\">\n                    <Radio :label=\"item.key\" v-for=\"(item,index) in radioList\" :key=\"index\">{{item.title}}</Radio>\n                </RadioGroup>\n            </FormItem>\n            <FormItem v-if=\"formValidate.gender == 1\" label=\"发货类型：\" class=\"form-item\" label-position=\"right\" :label-width=\"100\" :key=\"'test0'\">\n                <RadioGroup v-model=\"formValidate.shipStatus\">\n                    <Radio :label=\"item.key\" v-for=\"(item,index) in shipType\" :key=\"index\">{{item.title}}</Radio>\n                </RadioGroup>\n            </FormItem>\n            <!--  发货手动填写  -->\n            <div v-if=\"formValidate.gender == 1 && formValidate.shipStatus == 1\" :key=\"'test1'\">\n                <FormItem label=\"快递公司：\" prop=\"logisticsCode\" class=\"form-item\" label-position=\"right\" :label-width=\"100\"  >\n                    <Select v-model=\"formValidate.logisticsCode\" filterable placeholder=\"请选择\" @on-change=\"bindChange\" :label-in-value=\"true\" style=\"width: 100%\">\n                        <Option :value=\"item.code\" v-for=\"(item,index) in logisticsList\" :key=\"index\">{{item.value}}</Option>\n                    </Select>\n                </FormItem>\n                <FormItem label=\"快递单号：\" prop=\"number\" class=\"form-item\" label-position=\"right\" :label-width=\"100\">\n                    <Input v-model=\"formValidate.number\" placeholder=\"请输入快递单号\" style=\"width: 100%\"></Input>\n                </FormItem>\n            </div>\n            <!--  电子面单打印  -->\n            <div v-if=\"formValidate.gender == 1 && formValidate.shipStatus == 2\" :key=\"'test2'\">\n                <FormItem label=\"快递公司：\" prop=\"logisticsCode\" class=\"form-item\" label-position=\"right\" :label-width=\"100\">\n                    <Select v-model=\"formValidate.logisticsCode\" placeholder=\"请选择\" style=\"width: 100%\" @on-change=\"bindChange\" filterable :label-in-value=\"true\">\n                        <Option :value=\"item.code\" v-for=\"(item,index) in logisticsList\" :key=\"index\">{{item.value}}</Option>\n                    </Select>\n                </FormItem>\n                <FormItem label=\"电子面单：\" class=\"form-item\" label-position=\"right\" :label-width=\"100\" v-if=\"orderTempList.length>0\">\n                    <Select v-model=\"formValidate.electronic\" placeholder=\"请选择电子面单\" style=\"width: 80%\">\n                        <Option :value=\"item.temp_id\" v-for=\"(item,index) in orderTempList\">{{item.title}}</Option>\n                    </Select>\n                    <Button style=\"flex: 1;margin-left:21px;\" @click=\"lookImg\">预览</Button>\n                    <viewer :images=\"orderTempList\"\n                            class=\"viewer\" ref=\"viewer\"\n                            @inited=\"inited\"\n                            style=\"display: none\"\n                    >\n                        <img v-for=\"src in orderTempList\" :src=\"src.pic\" :key=\"src.id\" class=\"image\">\n                    </viewer>\n                </FormItem>\n                <FormItem label=\"寄件人姓名：\" prop=\"sendName\" class=\"form-item\" label-position=\"right\" :label-width=\"100\">\n                    <Input v-model=\"formValidate.sendName\" placeholder=\"请输入寄件人姓名\" style=\"width: 100%\"></Input>\n                </FormItem>\n                <FormItem label=\"寄件人电话：\" prop=\"sendPhone\" class=\"form-item\" label-position=\"right\" :label-width=\"100\">\n                    <Input v-model=\"formValidate.sendPhone\" placeholder=\"请输入寄件人电话\" style=\"width: 100%\"></Input>\n                </FormItem>\n                <FormItem label=\"寄件人地址：\" prop=\"sendAddress\" class=\"form-item\" label-position=\"right\" :label-width=\"100\">\n                    <Input v-model=\"formValidate.sendAddress\" placeholder=\"请输入寄件人地址\" style=\"width: 100%\"></Input>\n                </FormItem>\n            </div>\n            <!--  送货  -->\n            <div v-if=\"formValidate.gender == 2\" :key=\"'test3'\">\n                <FormItem label=\"选择送货人：\" class=\"form-item\" label-position=\"right\" :label-width=\"100\">\n                    <Select v-model=\"formValidate.postPeople\" placeholder=\"选择送货人\" style=\"width: 100%\">\n                        <Option :value=\"item.id\" v-for=\"(item,index) in deliveryList\" :key=\"index\">{{item.nickname}}</Option>\n                    </Select>\n                </FormItem>\n            </div>\n            <div v-if=\"formValidate.gender == 3\">\n                <FormItem label=\"备注：\" props=\"msg\" class=\"form-item\" label-position=\"right\" :label-width=\"100\">\n                    <Input placeholder=\"备注\" v-model=\"formValidate.msg\" />\n                </FormItem>\n            </div>\n            <div class=\"mask-footer\">\n                <Button type=\"primary\" @click=\"handleSubmit('formValidate')\">提交</Button>\n                <Button @click=\"close\">取消</Button>\n            </div>\n        </Form>\n\n    </div>\n\n</template>\n\n<script>\n    import { orderExport,orderTemp,orderDeliveryAll,orderDelivery,getSender } from '@/api/kefu'\n    export default {\n        name: \"delivery\",\n        props:{\n            isShow:{\n                type:Boolean,\n                default:false\n            },\n            orderId:{\n                type:String | Number,\n                default:''\n            }\n        },\n        watch:{\n            'formValidate.shipStatus':{\n                handler(nVal,oVal){\n                    if(nVal == 2 && !this.formValidate.sendName){\n                        getSender().then(res=>{\n                            this.formValidate.sendName = res.data.to_name\n                            this.formValidate.sendPhone = res.data.to_tel\n                            this.formValidate.sendAddress = res.data.to_add\n                        })\n                    }\n                    this.$refs['formValidate'].resetFields()\n                },\n                deep: true\n            },\n            'formValidate.gender':{\n                handler(nVal,oVal){\n\n                    this.$refs['formValidate'].resetFields()\n                },\n                deep: true\n            }\n        },\n        data(){\n            return {\n                shipType:[\n                    {\n                        key:1,\n                        title:'手动填写'\n                    },\n                    {\n                        key:2,\n                        title:'电子面单打印'\n                    },\n                ],\n                radioList:[\n                    {\n                        key:1,\n                        title:'发货'\n                    },\n                    {\n                        key:2,\n                        title:'送货'\n                    },\n                    {\n                        key:3,\n                        title:'虚拟'\n                    }\n                ],\n                ruleInline:{\n                    logisticsCode: [\n                        { required: true, message: '请选择快递公司', trigger: 'change' }\n                    ],\n                    number: [\n                        { required: true, message: '请填写快递单号', trigger: 'change' }\n                    ],\n                    sendName:[\n                        { required: true, message: '请填写寄件人姓名', trigger: 'change' }\n                    ],\n                    sendPhone:[\n                        { required: true, message: '请填写寄件人手机', trigger: 'change' },\n                        { pattern: /^1[3456789]\\d{9}$/, message: \"手机号码格式不正确\", trigger: \"blur\" }\n                    ],\n                    sendAddress:[\n                        { required: true, message: '请填写寄件人地址', trigger: 'change' }\n                    ],\n                    msg:[\n                        { required: true, message: '请填写备注信息', trigger: 'change' }\n                    ],\n                },\n                formValidate:{\n                    gender:1,\n                    shipStatus:1,\n                    logisticsCode:'', // 快递公司编号\n                    logisticsName:'', // 快递公司名称\n                    number:'', // 快递单号\n                    electronic:'', //电子面单\n                    sendName:'', //寄件人姓名\n                    sendPhone:'', // 寄件人电话\n                    sendAddress:'', //寄件人地址\n                    postPeople:'',  // 配送员\n                    msg:'' // 备注\n                },\n                logisticsList:[],\n                orderTempList:[],\n                deliveryList:[]\n            }\n        },\n        mounted() {\n            this.getOrderExport()\n            this.getDelivery()\n        },\n        methods:{\n            // 获取配送人\n            getDelivery(){\n                orderDeliveryAll().then(res=>{\n                    this.deliveryList = res.data\n                })\n            },\n            //查看大图\n            inited (viewer) {\n                this.$viewer = viewer\n            },\n            //物流公司\n            getOrderExport(){\n                orderExport().then(res=>{\n                    this.logisticsList = res.data\n                })\n            },\n            handleSubmit(name){\n                if(this.formValidate.gender == 1){\n                    this.$refs[name].validate((valid) => {\n                        let paramsData = {}\n                        paramsData.type = this.formValidate.gender\n                        paramsData.express_record_type = parseFloat(this.formValidate.shipStatus)\n                        paramsData.delivery_name = this.formValidate.logisticsName\n                        paramsData.delivery_code = this.formValidate.logisticsCode\n                        if (valid) {\n                            // 手动\n                            if(this.formValidate.gender == 1 && this.formValidate.shipStatus ==1){\n\n                                paramsData.delivery_id = this.formValidate.number\n                            }\n                            // 电子\n                            if(this.formValidate.gender == 1 && this.formValidate.shipStatus ==2){\n                                paramsData.to_name = this.formValidate.sendName\n                                paramsData.to_tel = this.formValidate.sendPhone\n                                paramsData.to_addr = this.formValidate.sendAddress\n                                paramsData.express_temp_id = this.formValidate.electronic\n                            }\n                            orderDelivery(this.orderId,paramsData).then(res=>{\n                                this.$Message.success(res.msg)\n                                this.$emit('ok')\n                            }).catch(error=>{\n                                this.$Message.error(error.msg)\n                            })\n                        } else {\n\n                        }\n                    })\n                }\n                if(this.formValidate.gender == 2){\n                    let people = {}\n                    this.deliveryList.forEach((el,index)=>{\n                        if(el.id == this.formValidate.postPeople){\n                            people = el\n                        }\n                    })\n                    orderDelivery(this.orderId,{\n                        type:this.formValidate.gender,\n                        sh_delivery_name:people.wx_name,\n                        sh_delivery_id:people.phone,\n                        sh_delivery_uid:people.id\n                    }).then(res=>{\n                        this.$Message.success(res.msg)\n                        this.$emit('ok')\n                    }).catch(error=>{\n                        this.$Message.error(error.msg)\n                    })\n                }\n                if(this.formValidate.gender == 3){\n                    orderDelivery(this.orderId,{\n                        type:this.formValidate.gender,\n                        remark:this.formValidate.msg\n                    }).then(res=>{\n                        this.$Message.success(res.msg)\n                        this.$emit('ok')\n                    }).catch(error=>{\n                        this.$Message.error(error.msg)\n                    })\n                }\n            },\n            close(){\n                this.$emit('close')\n            },\n            // 物流选中\n            bindChange(val){\n                console.log(val)\n                this.formValidate.logisticsName = val.label\n                if(this.formValidate.shipStatus == 2){\n                    orderTemp({\n                        com:val.value\n                    }).then(res=>{\n                        this.orderTempList = res.data.data\n                    })\n                }\n            },\n            lookImg(){\n                if(this.formValidate.electronic){\n                    this.orderTempList.forEach((el,index)=>{\n                        if(el.temp_id == this.formValidate.electronic){\n                            this.$viewer.view(index)\n                        }\n                    })\n\n                }else{\n                    this.$Message.error('请选择电子面单')\n                }\n            }\n        }\n    }\n</script>\n\n<style lang=\"stylus\" scoped>\n.form-item\n    width 100%\n</style>\n"]}]}