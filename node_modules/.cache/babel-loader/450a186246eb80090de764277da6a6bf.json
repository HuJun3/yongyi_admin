{"remainingRequest":"/Users/hujun/Downloads/永益科技后端/node_modules/babel-loader/lib/index.js!/Users/hujun/Downloads/永益科技后端/src/utils/videoCloud.js","dependencies":[{"path":"/Users/hujun/Downloads/永益科技后端/src/utils/videoCloud.js","mtime":1610587844000},{"path":"/Users/hujun/Downloads/永益科技后端/.babelrc","mtime":1610587842000},{"path":"/Users/hujun/Downloads/永益科技后端/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hujun/Downloads/永益科技后端/node_modules/babel-loader/lib/index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXM2LnJlZ2V4cC5yZXBsYWNlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXM2LmZ1bmN0aW9uLm5hbWUiOwppbXBvcnQgKiBhcyBxaW5pdSBmcm9tICdxaW5pdS1qcyc7CmltcG9ydCBDb3MgZnJvbSAnY29zLWpzLXNkay12NSc7CmltcG9ydCBheGlvcyBmcm9tICdheGlvcyc7CmV4cG9ydCBkZWZhdWx0IHsKICB2aWRlb1VwbG9hZDogZnVuY3Rpb24gdmlkZW9VcGxvYWQoY29uZmlnKSB7CiAgICBpZiAoY29uZmlnLnR5cGUgPT09ICdDT1MnKSB7CiAgICAgIHJldHVybiB0aGlzLmNvc1VwbG9hZChjb25maWcuZXZmaWxlLCBjb25maWcucmVzLmRhdGEsIGNvbmZpZy51cGxvYWRpbmcpOwogICAgfSBlbHNlIGlmIChjb25maWcudHlwZSA9PT0gJ09TUycpIHsKICAgICAgcmV0dXJuIHRoaXMub3NzSHR0cChjb25maWcuZXZmaWxlLCBjb25maWcucmVzLCBjb25maWcudXBsb2FkaW5nKTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiB0aGlzLnFpbml1SHR0cChjb25maWcuZXZmaWxlLCBjb25maWcucmVzLCBjb25maWcudXBsb2FkaW5nKTsKICAgIH0KICB9LAogIGNvc1VwbG9hZDogZnVuY3Rpb24gY29zVXBsb2FkKGZpbGUsIGNvbmZpZywgdXBsb2FkaW5nKSB7CiAgICBjb25zb2xlLmxvZyhjb25maWcpOwogICAgdmFyIGNvcyA9IG5ldyBDb3MoewogICAgICBnZXRBdXRob3JpemF0aW9uOiBmdW5jdGlvbiBnZXRBdXRob3JpemF0aW9uKG9wdGlvbnMsIGNhbGxiYWNrKSB7CiAgICAgICAgY2FsbGJhY2soewogICAgICAgICAgVG1wU2VjcmV0SWQ6IGNvbmZpZy5jcmVkZW50aWFscy50bXBTZWNyZXRJZCwKICAgICAgICAgIC8vIOS4tOaXtuWvhumSpeeahCB0bXBTZWNyZXRJZAogICAgICAgICAgVG1wU2VjcmV0S2V5OiBjb25maWcuY3JlZGVudGlhbHMudG1wU2VjcmV0S2V5LAogICAgICAgICAgLy8g5Li05pe25a+G6ZKl55qEIHRtcFNlY3JldEtleQogICAgICAgICAgWENvc1NlY3VyaXR5VG9rZW46IGNvbmZpZy5jcmVkZW50aWFscy5zZXNzaW9uVG9rZW4sCiAgICAgICAgICAvLyDkuLTml7blr4bpkqXnmoQgc2Vzc2lvblRva2VuCiAgICAgICAgICBFeHBpcmVkVGltZTogY29uZmlnLmV4cGlyZWRUaW1lIC8vIOS4tOaXtuWvhumSpeWkseaViOaXtumXtOaIs++8jOaYr+eUs+ivt+S4tOaXtuWvhumSpeaXtu+8jOaXtumXtOaIs+WKoCBkdXJhdGlvblNlY29uZHMKCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0pOwogICAgdmFyIGZpbGVPYmplY3QgPSBmaWxlLnRhcmdldC5maWxlc1swXTsKICAgIGNvbnNvbGUubG9nKGZpbGVPYmplY3QpOwogICAgdmFyIEtleSA9IGZpbGVPYmplY3QubmFtZTsKICAgIHZhciBwb3MgPSBLZXkubGFzdEluZGV4T2YoJy4nKTsKICAgIHZhciBzdWZmaXggPSAnJzsKCiAgICBpZiAocG9zICE9PSAtMSkgewogICAgICBzdWZmaXggPSBLZXkuc3Vic3RyaW5nKHBvcyk7CiAgICB9CgogICAgdmFyIGZpbGVuYW1lID0gbmV3IERhdGUoKS5nZXRUaW1lKCkgKyBzdWZmaXg7CiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICBjb3Muc2xpY2VVcGxvYWRGaWxlKHsKICAgICAgICBCdWNrZXQ6IGNvbmZpZy5idWNrZXQsCgogICAgICAgIC8qIOW/hemhuyAqLwogICAgICAgIFJlZ2lvbjogY29uZmlnLnJlZ2lvbiwKCiAgICAgICAgLyog5b+F6aG7ICovCiAgICAgICAgS2V5OiBmaWxlbmFtZSwKCiAgICAgICAgLyog5b+F6aG7ICovCiAgICAgICAgQm9keTogZmlsZU9iamVjdCwKICAgICAgICAvLyDkuIrkvKDmlofku7blr7nosaEKICAgICAgICBvblByb2dyZXNzOiBmdW5jdGlvbiBvblByb2dyZXNzKHByb2dyZXNzRGF0YSkgewogICAgICAgICAgY29uc29sZS5sb2cocHJvZ3Jlc3NEYXRhKTsKICAgICAgICAgIHVwbG9hZGluZyhwcm9ncmVzc0RhdGEpOwogICAgICAgIH0KICAgICAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkgewogICAgICAgIGlmIChlcnIpIHsKICAgICAgICAgIHJlamVjdCh7CiAgICAgICAgICAgIG1zZzogZXJyCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmVzb2x2ZSh7CiAgICAgICAgICAgIHVybDogJ2h0dHA6Ly8nICsgZGF0YS5Mb2NhdGlvbiwKICAgICAgICAgICAgRVRhZzogZGF0YS5FVGFnCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSk7CiAgfSwKICBjb3NIdHRwOiBmdW5jdGlvbiBjb3NIdHRwKGV2ZmlsZSwgcmVzLCB2aWRlb0luZykgewogICAgLy8g6IW+6K6v5LqRCiAgICAvLyDlr7nmm7TlpJrlrZfnrKbnvJbnoIHnmoQgdXJsIGVuY29kZSDmoLzlvI8KICAgIHZhciBjYW1TYWZlVXJsRW5jb2RlID0gZnVuY3Rpb24gY2FtU2FmZVVybEVuY29kZShzdHIpIHsKICAgICAgcmV0dXJuIGVuY29kZVVSSUNvbXBvbmVudChzdHIpLnJlcGxhY2UoLyEvZywgJyUyMScpLnJlcGxhY2UoLycvZywgJyUyNycpLnJlcGxhY2UoL1woL2csICclMjgnKS5yZXBsYWNlKC9cKS9nLCAnJTI5JykucmVwbGFjZSgvXCovZywgJyUyQScpOwogICAgfTsKCiAgICB2YXIgZmlsZU9iamVjdCA9IGV2ZmlsZS50YXJnZXQuZmlsZXNbMF07CiAgICB2YXIgS2V5ID0gZmlsZU9iamVjdC5uYW1lOwogICAgdmFyIHBvcyA9IEtleS5sYXN0SW5kZXhPZignLicpOwogICAgdmFyIHN1ZmZpeCA9ICcnOwoKICAgIGlmIChwb3MgIT09IC0xKSB7CiAgICAgIHN1ZmZpeCA9IEtleS5zdWJzdHJpbmcocG9zKTsKICAgIH0KCiAgICB2YXIgZmlsZW5hbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKSArIHN1ZmZpeDsKICAgIHZhciBkYXRhID0gcmVzLmRhdGE7CiAgICB2YXIgWENvc1NlY3VyaXR5VG9rZW4gPSBkYXRhLmNyZWRlbnRpYWxzLnNlc3Npb25Ub2tlbjsKICAgIHZhciB1cmwgPSBkYXRhLnVybCArIGNhbVNhZmVVcmxFbmNvZGUoZmlsZW5hbWUpLnJlcGxhY2UoLyUyRi9nLCAnLycpOwogICAgdmFyIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOwogICAgeGhyLm9wZW4oJ1BVVCcsIHVybCwgdHJ1ZSk7CiAgICBYQ29zU2VjdXJpdHlUb2tlbiAmJiB4aHIuc2V0UmVxdWVzdEhlYWRlcigneC1jb3Mtc2VjdXJpdHktdG9rZW4nLCBYQ29zU2VjdXJpdHlUb2tlbik7CgogICAgeGhyLnVwbG9hZC5vbnByb2dyZXNzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHByb2dyZXNzID0gTWF0aC5yb3VuZChlLmxvYWRlZCAvIGUudG90YWwgKiAxMDAwMCkgLyAxMDA7CiAgICAgIHZpZGVvSW5nKHRydWUsIHByb2dyZXNzKTsKICAgIH07CgogICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgeGhyLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBjb25zb2xlLmxvZygn5LiK5Lyg5LitJyk7CgogICAgICAgIGlmICgvXjJcZFxkJC8udGVzdCgnJyArIHhoci5zdGF0dXMpKSB7CiAgICAgICAgICB2YXIgRVRhZyA9IHhoci5nZXRSZXNwb25zZUhlYWRlcignZXRhZycpOwogICAgICAgICAgY29uc29sZS5sb2cobnVsbCwgewogICAgICAgICAgICB1cmw6IHVybCwKICAgICAgICAgICAgRVRhZzogRVRhZwogICAgICAgICAgfSk7CiAgICAgICAgICB2aWRlb0luZyhmYWxzZSwgMCk7CiAgICAgICAgICByZXNvbHZlKHsKICAgICAgICAgICAgdXJsOiB1cmwsCiAgICAgICAgICAgIEVUYWc6IEVUYWcKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZWplY3QoewogICAgICAgICAgICBtc2c6ICfmlofku7YgJyArIGZpbGVuYW1lICsgJyDkuIrkvKDlpLHotKXvvIznirbmgIHnoIHvvJonICsgeGhyLnN0YXR1CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH07CgogICAgICB4aHIub25lcnJvciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZWplY3QoewogICAgICAgICAgbXNnOiAn5paH5Lu2ICcgKyBmaWxlbmFtZSArICfkuIrkvKDlpLHotKXvvIzor7fmo4Dmn6XmmK/lkKbmsqHphY3nva4gQ09SUyDot6jln5/op4QnCiAgICAgICAgfSk7CiAgICAgIH07CgogICAgICB4aHIuc2VuZChmaWxlT2JqZWN0KTsKCiAgICAgIHhoci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgY29uc29sZS5sb2coeGhyLnN0YXR1c1RleHQsIHhoci5yZXNwb25zZVRleHQsICd4aHInKTsKICAgICAgfTsKICAgIH0pOwogIH0sCiAgb3NzSHR0cDogZnVuY3Rpb24gb3NzSHR0cChldmZpbGUsIHJlcywgdmlkZW9JbmcpIHsKICAgIHZhciB0aGF0ID0gdGhpczsKICAgIHZhciBmaWxlT2JqZWN0ID0gZXZmaWxlLnRhcmdldC5maWxlc1swXTsKICAgIHZhciBmaWxlID0gZmlsZU9iamVjdC5uYW1lOwogICAgdmFyIHBvcyA9IGZpbGUubGFzdEluZGV4T2YoJy4nKTsKICAgIHZhciBzdWZmaXggPSAnJzsKCiAgICBpZiAocG9zICE9PSAtMSkgewogICAgICBzdWZmaXggPSBmaWxlLnN1YnN0cmluZyhwb3MpOwogICAgfQoKICAgIHZhciBmaWxlbmFtZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpICsgc3VmZml4OwogICAgdmFyIGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7CiAgICB2YXIgZGF0YSA9IHJlcy5kYXRhOyAvLyDms6jmhI9mb3JtRGF0YemHjGFwcGVuZOa3u+WKoOeahOmUrueahOWkp+Wwj+WGmQoKICAgIGZvcm1EYXRhLmFwcGVuZCgna2V5JywgZmlsZW5hbWUpOyAvLyDlrZjlgqjlnKhvc3PnmoTmlofku7bot6/lvoQKCiAgICBmb3JtRGF0YS5hcHBlbmQoJ09TU0FjY2Vzc0tleUlkJywgZGF0YS5hY2Nlc3NpZCk7IC8vIGFjY2Vzc0tleUlkCgogICAgZm9ybURhdGEuYXBwZW5kKCdwb2xpY3knLCBkYXRhLnBvbGljeSk7IC8vIHBvbGljeQoKICAgIGZvcm1EYXRhLmFwcGVuZCgnU2lnbmF0dXJlJywgZGF0YS5zaWduYXR1cmUpOyAvLyDnrb7lkI0KICAgIC8vIOWmguaenOaYr2Jhc2U2NOaWh+S7tu+8jOmCo+S5iOebtOaOpeaKimJhc2U2NOWtl+espuS4sui9rOaIkGJsb2Llr7nosaHov5vooYzkuIrkvKDlsLHlj6/ku6XkuoYKCiAgICBmb3JtRGF0YS5hcHBlbmQoJ2ZpbGUnLCBmaWxlT2JqZWN0KTsKICAgIGZvcm1EYXRhLmFwcGVuZCgnc3VjY2Vzc19hY3Rpb25fc3RhdHVzJywgMjAwKTsgLy8g5oiQ5Yqf5ZCO6L+U5Zue55qE5pON5L2c56CBCgogICAgdmFyIHVybCA9IGRhdGEuaG9zdDsKICAgIHZhciBmaWxlVXJsID0gdXJsICsgJy8nICsgZmlsZW5hbWU7CiAgICB2aWRlb0luZyh0cnVlLCAxMDApOwogICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgYXhpb3MuZGVmYXVsdHMud2l0aENyZWRlbnRpYWxzID0gZmFsc2U7CiAgICAgIGF4aW9zLnBvc3QodXJsLCBmb3JtRGF0YSkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgLy8gdGhhdC5wcm9ncmVzcyA9IDA7CiAgICAgICAgdmlkZW9JbmcoZmFsc2UsIDApOwogICAgICAgIHJlc29sdmUoewogICAgICAgICAgdXJsOiBmaWxlVXJsCiAgICAgICAgfSk7CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICByZWplY3QoewogICAgICAgICAgbXNnOiByZXMKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9KTsKICB9LAogIHFpbml1SHR0cDogZnVuY3Rpb24gcWluaXVIdHRwKGV2ZmlsZSwgcmVzLCB2aWRlb0luZykgewogICAgdmFyIHVwdG9rZW4gPSByZXMuZGF0YS50b2tlbjsKICAgIHZhciBmaWxlID0gZXZmaWxlLnRhcmdldC5maWxlc1swXTsgLy8gQmxvYiDlr7nosaHvvIzkuIrkvKDnmoTmlofku7YKCiAgICB2YXIgS2V5ID0gZmlsZS5uYW1lOyAvLyDkuIrkvKDlkI7mlofku7botYTmupDlkI3ku6Xorr7nva7nmoQga2V5IOS4uuS4u++8jOWmguaenCBrZXkg5Li6IG51bGwg5oiW6ICFIHVuZGVmaW5lZO+8jOWImeaWh+S7tui1hOa6kOWQjeS8muS7pSBoYXNoIOWAvOS9nOS4uui1hOa6kOWQjeOAggoKICAgIHZhciBwb3MgPSBLZXkubGFzdEluZGV4T2YoJy4nKTsKICAgIHZhciBzdWZmaXggPSAnJzsKCiAgICBpZiAocG9zICE9PSAtMSkgewogICAgICBzdWZmaXggPSBLZXkuc3Vic3RyaW5nKHBvcyk7CiAgICB9CgogICAgdmFyIGZpbGVuYW1lID0gbmV3IERhdGUoKS5nZXRUaW1lKCkgKyBzdWZmaXg7CiAgICB2YXIgZmlsZVVybCA9IHJlcy5kYXRhLmRvbWFpbiArICcvJyArIGZpbGVuYW1lOwogICAgdmFyIGNvbmZpZyA9IHsKICAgICAgdXNlQ2RuRG9tYWluOiB0cnVlCiAgICB9OwogICAgdmFyIHB1dEV4dHJhID0gewogICAgICBmbmFtZTogJycsCiAgICAgIC8vIOaWh+S7tuWOn+aWh+S7tuWQjQogICAgICBwYXJhbXM6IHt9LAogICAgICAvLyDnlKjmnaXmlL7nva7oh6rlrprkuYnlj5jph48KICAgICAgbWltZVR5cGU6IG51bGwgLy8g55So5p2l6ZmQ5Yi25LiK5Lyg5paH5Lu257G75Z6L77yM5Li6IG51bGwg5pe26KGo56S65LiN5a+55paH5Lu257G75Z6L6ZmQ5Yi277yb6ZmQ5Yi257G75Z6L5pS+5Yiw5pWw57uE6YeM77yaIFsiaW1hZ2UvcG5nIiwgImltYWdlL2pwZWciLCAiaW1hZ2UvZ2lmIl0KCiAgICB9OwogICAgdmFyIG9ic2VydmFibGUgPSBxaW5pdS51cGxvYWQoZmlsZSwgZmlsZW5hbWUsIHVwdG9rZW4sIHB1dEV4dHJhLCBjb25maWcpOwogICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgb2JzZXJ2YWJsZS5zdWJzY3JpYmUoewogICAgICAgIG5leHQ6IGZ1bmN0aW9uIG5leHQocmVzdWx0KSB7CiAgICAgICAgICBjb25zb2xlLmxvZyhyZXN1bHQpOwogICAgICAgICAgdmFyIHByb2dyZXNzID0gTWF0aC5yb3VuZChyZXN1bHQudG90YWwubG9hZGVkIC8gcmVzdWx0LnRvdGFsLnNpemUpOwogICAgICAgICAgdmlkZW9JbmcodHJ1ZSwgcHJvZ3Jlc3MpOyAvLyDkuLvopoHnlKjmnaXlsZXnpLrov5vluqYKICAgICAgICB9LAogICAgICAgIGVycm9yOiBmdW5jdGlvbiBlcnJvcihlcnJSZXN1bHQpIHsKICAgICAgICAgIC8vIOWksei0peaKpemUmeS/oeaBrwogICAgICAgICAgcmVqZWN0KHsKICAgICAgICAgICAgbXNnOiBlcnJSZXN1bHQKICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgY29tcGxldGU6IGZ1bmN0aW9uIGNvbXBsZXRlKHJlc3VsdCkgewogICAgICAgICAgLy8g5o6l5pS25oiQ5Yqf5ZCO6L+U5Zue55qE5L+h5oGvCiAgICAgICAgICB2aWRlb0luZyhmYWxzZSwgMCk7CiAgICAgICAgICByZXNvbHZlKHsKICAgICAgICAgICAgdXJsOiBmaWxlVXJsCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSk7CiAgfQp9Ow=="},{"version":3,"sources":["/Users/hujun/Downloads/永益科技后端/src/utils/videoCloud.js"],"names":["qiniu","Cos","axios","videoUpload","config","type","cosUpload","evfile","res","data","uploading","ossHttp","qiniuHttp","file","console","log","cos","getAuthorization","options","callback","TmpSecretId","credentials","tmpSecretId","TmpSecretKey","tmpSecretKey","XCosSecurityToken","sessionToken","ExpiredTime","expiredTime","fileObject","target","files","Key","name","pos","lastIndexOf","suffix","substring","filename","Date","getTime","Promise","resolve","reject","sliceUploadFile","Bucket","bucket","Region","region","Body","onProgress","progressData","err","msg","url","Location","ETag","cosHttp","videoIng","camSafeUrlEncode","str","encodeURIComponent","replace","xhr","XMLHttpRequest","open","setRequestHeader","upload","onprogress","e","progress","Math","round","loaded","total","onload","test","status","getResponseHeader","statu","onerror","send","onreadystatechange","statusText","responseText","that","formData","FormData","append","accessid","policy","signature","host","fileUrl","defaults","withCredentials","post","then","catch","uptoken","token","domain","useCdnDomain","putExtra","fname","params","mimeType","observable","subscribe","next","result","size","error","errResult","complete"],"mappings":";;AAAA,OAAO,KAAKA,KAAZ,MAAuB,UAAvB;AACA,OAAOC,GAAP,MAAgB,eAAhB;AACA,OAAOC,KAAP,MAAkB,OAAlB;AAEA,eAAe;AAEXC,EAAAA,WAFW,uBAEEC,MAFF,EAEU;AACjB,QAAIA,MAAM,CAACC,IAAP,KAAgB,KAApB,EAA2B;AACvB,aAAO,KAAKC,SAAL,CAAeF,MAAM,CAACG,MAAtB,EAA8BH,MAAM,CAACI,GAAP,CAAWC,IAAzC,EAA+CL,MAAM,CAACM,SAAtD,CAAP;AACH,KAFD,MAEO,IAAIN,MAAM,CAACC,IAAP,KAAgB,KAApB,EAA2B;AAC9B,aAAO,KAAKM,OAAL,CAAaP,MAAM,CAACG,MAApB,EAA4BH,MAAM,CAACI,GAAnC,EAAwCJ,MAAM,CAACM,SAA/C,CAAP;AACH,KAFM,MAEA;AACH,aAAO,KAAKE,SAAL,CAAeR,MAAM,CAACG,MAAtB,EAA8BH,MAAM,CAACI,GAArC,EAA0CJ,MAAM,CAACM,SAAjD,CAAP;AACH;AACJ,GAVU;AAWXJ,EAAAA,SAXW,qBAWAO,IAXA,EAWMT,MAXN,EAWcM,SAXd,EAWyB;AAChCI,IAAAA,OAAO,CAACC,GAAR,CAAYX,MAAZ;AACA,QAAIY,GAAG,GAAG,IAAIf,GAAJ,CAAQ;AACdgB,MAAAA,gBADc,4BACIC,OADJ,EACaC,QADb,EACuB;AACjCA,QAAAA,QAAQ,CAAC;AACLC,UAAAA,WAAW,EAAEhB,MAAM,CAACiB,WAAP,CAAmBC,WAD3B;AACwC;AAC7CC,UAAAA,YAAY,EAAEnB,MAAM,CAACiB,WAAP,CAAmBG,YAF5B;AAE0C;AAC/CC,UAAAA,iBAAiB,EAAErB,MAAM,CAACiB,WAAP,CAAmBK,YAHjC;AAG+C;AACpDC,UAAAA,WAAW,EAAEvB,MAAM,CAACwB,WAJf,CAI2B;;AAJ3B,SAAD,CAAR;AAMH;AARa,KAAR,CAAV;AAUA,QAAIC,UAAU,GAAGhB,IAAI,CAACiB,MAAL,CAAYC,KAAZ,CAAkB,CAAlB,CAAjB;AACAjB,IAAAA,OAAO,CAACC,GAAR,CAAYc,UAAZ;AACA,QAAIG,GAAG,GAAGH,UAAU,CAACI,IAArB;AACA,QAAIC,GAAG,GAAGF,GAAG,CAACG,WAAJ,CAAgB,GAAhB,CAAV;AACA,QAAIC,MAAM,GAAG,EAAb;;AACA,QAAIF,GAAG,KAAK,CAAC,CAAb,EAAgB;AACZE,MAAAA,MAAM,GAAGJ,GAAG,CAACK,SAAJ,CAAcH,GAAd,CAAT;AACH;;AACD,QAAII,QAAQ,GAAG,IAAIC,IAAJ,GAAWC,OAAX,KAAuBJ,MAAtC;AACA,WAAO,IAAIK,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACpC3B,MAAAA,GAAG,CAAC4B,eAAJ,CAAoB;AAChBC,QAAAA,MAAM,EAAEzC,MAAM,CAAC0C,MADC;;AACO;AACvBC,QAAAA,MAAM,EAAE3C,MAAM,CAAC4C,MAFC;;AAEO;AACvBhB,QAAAA,GAAG,EAAEM,QAHW;;AAGD;AACfW,QAAAA,IAAI,EAAEpB,UAJU;AAIE;AAClBqB,QAAAA,UAAU,EAAE,oBAAUC,YAAV,EAAwB;AAChCrC,UAAAA,OAAO,CAACC,GAAR,CAAYoC,YAAZ;AACAzC,UAAAA,SAAS,CAACyC,YAAD,CAAT;AACH;AARe,OAApB,EASG,UAAUC,GAAV,EAAe3C,IAAf,EAAqB;AACpB,YAAI2C,GAAJ,EAAS;AACLT,UAAAA,MAAM,CAAC;AAAEU,YAAAA,GAAG,EAAED;AAAP,WAAD,CAAN;AACH,SAFD,MAEO;AACHV,UAAAA,OAAO,CAAC;AAAEY,YAAAA,GAAG,EAAE,YAAY7C,IAAI,CAAC8C,QAAxB;AAAkCC,YAAAA,IAAI,EAAE/C,IAAI,CAAC+C;AAA7C,WAAD,CAAP;AACH;AACJ,OAfD;AAgBH,KAjBM,CAAP;AAkBH,GAlDU;AAmDXC,EAAAA,OAnDW,mBAmDFlD,MAnDE,EAmDMC,GAnDN,EAmDWkD,QAnDX,EAmDqB;AAC5B;AACA;AACA,QAAIC,gBAAgB,GAAG,SAAnBA,gBAAmB,CAAUC,GAAV,EAAe;AAClC,aAAOC,kBAAkB,CAACD,GAAD,CAAlB,CACFE,OADE,CACM,IADN,EACY,KADZ,EAEFA,OAFE,CAEM,IAFN,EAEY,KAFZ,EAGFA,OAHE,CAGM,KAHN,EAGa,KAHb,EAIFA,OAJE,CAIM,KAJN,EAIa,KAJb,EAKFA,OALE,CAKM,KALN,EAKa,KALb,CAAP;AAMH,KAPD;;AAQA,QAAIjC,UAAU,GAAGtB,MAAM,CAACuB,MAAP,CAAcC,KAAd,CAAoB,CAApB,CAAjB;AACA,QAAIC,GAAG,GAAGH,UAAU,CAACI,IAArB;AACA,QAAIC,GAAG,GAAGF,GAAG,CAACG,WAAJ,CAAgB,GAAhB,CAAV;AACA,QAAIC,MAAM,GAAG,EAAb;;AACA,QAAIF,GAAG,KAAK,CAAC,CAAb,EAAgB;AACZE,MAAAA,MAAM,GAAGJ,GAAG,CAACK,SAAJ,CAAcH,GAAd,CAAT;AACH;;AACD,QAAII,QAAQ,GAAG,IAAIC,IAAJ,GAAWC,OAAX,KAAuBJ,MAAtC;AACA,QAAI3B,IAAI,GAAGD,GAAG,CAACC,IAAf;AACA,QAAIgB,iBAAiB,GAAGhB,IAAI,CAACY,WAAL,CAAiBK,YAAzC;AACA,QAAI4B,GAAG,GAAG7C,IAAI,CAAC6C,GAAL,GAAWK,gBAAgB,CAACrB,QAAD,CAAhB,CAA2BwB,OAA3B,CAAmC,MAAnC,EAA2C,GAA3C,CAArB;AACA,QAAIC,GAAG,GAAG,IAAIC,cAAJ,EAAV;AACAD,IAAAA,GAAG,CAACE,IAAJ,CAAS,KAAT,EAAgBX,GAAhB,EAAqB,IAArB;AACA7B,IAAAA,iBAAiB,IAAIsC,GAAG,CAACG,gBAAJ,CAAqB,sBAArB,EAA6CzC,iBAA7C,CAArB;;AACAsC,IAAAA,GAAG,CAACI,MAAJ,CAAWC,UAAX,GAAwB,UAAUC,CAAV,EAAa;AACjC,UAAIC,QAAQ,GAAGC,IAAI,CAACC,KAAL,CAAWH,CAAC,CAACI,MAAF,GAAWJ,CAAC,CAACK,KAAb,GAAqB,KAAhC,IAAyC,GAAxD;AACAhB,MAAAA,QAAQ,CAAC,IAAD,EAAOY,QAAP,CAAR;AACH,KAHD;;AAIA,WAAO,IAAI7B,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACpCoB,MAAAA,GAAG,CAACY,MAAJ,GAAa,YAAY;AACrB7D,QAAAA,OAAO,CAACC,GAAR,CAAY,KAAZ;;AACA,YAAI,UAAU6D,IAAV,CAAe,KAAKb,GAAG,CAACc,MAAxB,CAAJ,EAAqC;AACjC,cAAIrB,IAAI,GAAGO,GAAG,CAACe,iBAAJ,CAAsB,MAAtB,CAAX;AACAhE,UAAAA,OAAO,CAACC,GAAR,CAAY,IAAZ,EAAkB;AAAEuC,YAAAA,GAAG,EAAEA,GAAP;AAAYE,YAAAA,IAAI,EAAEA;AAAlB,WAAlB;AACAE,UAAAA,QAAQ,CAAC,KAAD,EAAQ,CAAR,CAAR;AACAhB,UAAAA,OAAO,CAAC;AAAEY,YAAAA,GAAG,EAAEA,GAAP;AAAYE,YAAAA,IAAI,EAAEA;AAAlB,WAAD,CAAP;AACH,SALD,MAKO;AACHb,UAAAA,MAAM,CAAC;AAAEU,YAAAA,GAAG,EAAE,QAAQf,QAAR,GAAmB,YAAnB,GAAkCyB,GAAG,CAACgB;AAA7C,WAAD,CAAN;AACH;AACJ,OAVD;;AAWAhB,MAAAA,GAAG,CAACiB,OAAJ,GAAc,YAAY;AACtBrC,QAAAA,MAAM,CAAC;AAAEU,UAAAA,GAAG,EAAE,QAAQf,QAAR,GAAmB;AAA1B,SAAD,CAAN;AACH,OAFD;;AAGAyB,MAAAA,GAAG,CAACkB,IAAJ,CAASpD,UAAT;;AACAkC,MAAAA,GAAG,CAACmB,kBAAJ,GAAyB,YAAY;AACjCpE,QAAAA,OAAO,CAACC,GAAR,CAAYgD,GAAG,CAACoB,UAAhB,EAA4BpB,GAAG,CAACqB,YAAhC,EAA8C,KAA9C;AACH,OAFD;AAGH,KAnBM,CAAP;AAoBH,GApGU;AAqGXzE,EAAAA,OArGW,mBAqGFJ,MArGE,EAqGMC,GArGN,EAqGWkD,QArGX,EAqGqB;AAC5B,QAAI2B,IAAI,GAAG,IAAX;AACA,QAAIxD,UAAU,GAAGtB,MAAM,CAACuB,MAAP,CAAcC,KAAd,CAAoB,CAApB,CAAjB;AACA,QAAIlB,IAAI,GAAGgB,UAAU,CAACI,IAAtB;AACA,QAAIC,GAAG,GAAGrB,IAAI,CAACsB,WAAL,CAAiB,GAAjB,CAAV;AACA,QAAIC,MAAM,GAAG,EAAb;;AACA,QAAIF,GAAG,KAAK,CAAC,CAAb,EAAgB;AACZE,MAAAA,MAAM,GAAGvB,IAAI,CAACwB,SAAL,CAAeH,GAAf,CAAT;AACH;;AACD,QAAII,QAAQ,GAAG,IAAIC,IAAJ,GAAWC,OAAX,KAAuBJ,MAAtC;AACA,QAAIkD,QAAQ,GAAG,IAAIC,QAAJ,EAAf;AACA,QAAI9E,IAAI,GAAGD,GAAG,CAACC,IAAf,CAX4B,CAY5B;;AACA6E,IAAAA,QAAQ,CAACE,MAAT,CAAgB,KAAhB,EAAuBlD,QAAvB,EAb4B,CAaM;;AAClCgD,IAAAA,QAAQ,CAACE,MAAT,CAAgB,gBAAhB,EAAkC/E,IAAI,CAACgF,QAAvC,EAd4B,CAcsB;;AAClDH,IAAAA,QAAQ,CAACE,MAAT,CAAgB,QAAhB,EAA0B/E,IAAI,CAACiF,MAA/B,EAf4B,CAeY;;AACxCJ,IAAAA,QAAQ,CAACE,MAAT,CAAgB,WAAhB,EAA6B/E,IAAI,CAACkF,SAAlC,EAhB4B,CAgBkB;AAC9C;;AACAL,IAAAA,QAAQ,CAACE,MAAT,CAAgB,MAAhB,EAAwB3D,UAAxB;AACAyD,IAAAA,QAAQ,CAACE,MAAT,CAAgB,uBAAhB,EAAyC,GAAzC,EAnB4B,CAmBmB;;AAC/C,QAAIlC,GAAG,GAAG7C,IAAI,CAACmF,IAAf;AACA,QAAIC,OAAO,GAAGvC,GAAG,GAAG,GAAN,GAAYhB,QAA1B;AACAoB,IAAAA,QAAQ,CAAC,IAAD,EAAO,GAAP,CAAR;AACA,WAAO,IAAIjB,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACpCzC,MAAAA,KAAK,CAAC4F,QAAN,CAAeC,eAAf,GAAiC,KAAjC;AACA7F,MAAAA,KAAK,CAAC8F,IAAN,CAAW1C,GAAX,EAAgBgC,QAAhB,EAA0BW,IAA1B,CAA+B,YAAM;AACjC;AACAvC,QAAAA,QAAQ,CAAC,KAAD,EAAQ,CAAR,CAAR;AACAhB,QAAAA,OAAO,CAAC;AAAEY,UAAAA,GAAG,EAAEuC;AAAP,SAAD,CAAP;AACH,OAJD,EAIGK,KAJH,CAIS,UAAA1F,GAAG,EAAI;AACZmC,QAAAA,MAAM,CAAC;AAAEU,UAAAA,GAAG,EAAE7C;AAAP,SAAD,CAAN;AACH,OAND;AAOH,KATM,CAAP;AAUH,GAtIU;AAuIXI,EAAAA,SAvIW,qBAuIAL,MAvIA,EAuIQC,GAvIR,EAuIakD,QAvIb,EAuIuB;AAC9B,QAAIyC,OAAO,GAAG3F,GAAG,CAACC,IAAJ,CAAS2F,KAAvB;AACA,QAAIvF,IAAI,GAAGN,MAAM,CAACuB,MAAP,CAAcC,KAAd,CAAoB,CAApB,CAAX,CAF8B,CAEK;;AACnC,QAAIC,GAAG,GAAGnB,IAAI,CAACoB,IAAf,CAH8B,CAGT;;AACrB,QAAIC,GAAG,GAAGF,GAAG,CAACG,WAAJ,CAAgB,GAAhB,CAAV;AACA,QAAIC,MAAM,GAAG,EAAb;;AACA,QAAIF,GAAG,KAAK,CAAC,CAAb,EAAgB;AACZE,MAAAA,MAAM,GAAGJ,GAAG,CAACK,SAAJ,CAAcH,GAAd,CAAT;AACH;;AACD,QAAII,QAAQ,GAAG,IAAIC,IAAJ,GAAWC,OAAX,KAAuBJ,MAAtC;AACA,QAAIyD,OAAO,GAAGrF,GAAG,CAACC,IAAJ,CAAS4F,MAAT,GAAkB,GAAlB,GAAwB/D,QAAtC;AACA,QAAIlC,MAAM,GAAG;AACTkG,MAAAA,YAAY,EAAE;AADL,KAAb;AAGA,QAAIC,QAAQ,GAAG;AACXC,MAAAA,KAAK,EAAE,EADI;AACA;AACXC,MAAAA,MAAM,EAAE,EAFG;AAEC;AACZC,MAAAA,QAAQ,EAAE,IAHC,CAGI;;AAHJ,KAAf;AAKA,QAAIC,UAAU,GAAG3G,KAAK,CAACmE,MAAN,CAAatD,IAAb,EAAmByB,QAAnB,EAA6B6D,OAA7B,EAAsCI,QAAtC,EAAgDnG,MAAhD,CAAjB;AACA,WAAO,IAAIqC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACpCgE,MAAAA,UAAU,CAACC,SAAX,CAAqB;AACjBC,QAAAA,IAAI,EAAE,cAACC,MAAD,EAAY;AACdhG,UAAAA,OAAO,CAACC,GAAR,CAAY+F,MAAZ;AACA,cAAIxC,QAAQ,GAAGC,IAAI,CAACC,KAAL,CAAWsC,MAAM,CAACpC,KAAP,CAAaD,MAAb,GAAsBqC,MAAM,CAACpC,KAAP,CAAaqC,IAA9C,CAAf;AACArD,UAAAA,QAAQ,CAAC,IAAD,EAAOY,QAAP,CAAR,CAHc,CAId;AACH,SANgB;AAOjB0C,QAAAA,KAAK,EAAE,eAACC,SAAD,EAAe;AAClB;AACAtE,UAAAA,MAAM,CAAC;AAAEU,YAAAA,GAAG,EAAE4D;AAAP,WAAD,CAAN;AACH,SAVgB;AAWjBC,QAAAA,QAAQ,EAAE,kBAACJ,MAAD,EAAY;AAClB;AACApD,UAAAA,QAAQ,CAAC,KAAD,EAAQ,CAAR,CAAR;AACAhB,UAAAA,OAAO,CAAC;AAAEY,YAAAA,GAAG,EAAEuC;AAAP,WAAD,CAAP;AACH;AAfgB,OAArB;AAiBH,KAlBM,CAAP;AAmBH;AA9KU,CAAf","sourcesContent":["import * as qiniu from 'qiniu-js';\nimport Cos from 'cos-js-sdk-v5';\nimport axios from 'axios';\n\nexport default {\n\n    videoUpload (config) {\n        if (config.type === 'COS') {\n            return this.cosUpload(config.evfile, config.res.data, config.uploading);\n        } else if (config.type === 'OSS') {\n            return this.ossHttp(config.evfile, config.res, config.uploading);\n        } else {\n            return this.qiniuHttp(config.evfile, config.res, config.uploading);\n        }\n    },\n    cosUpload (file, config, uploading) {\n        console.log(config);\n        let cos = new Cos({\n            getAuthorization (options, callback) {\n                callback({\n                    TmpSecretId: config.credentials.tmpSecretId, // 临时密钥的 tmpSecretId\n                    TmpSecretKey: config.credentials.tmpSecretKey, // 临时密钥的 tmpSecretKey\n                    XCosSecurityToken: config.credentials.sessionToken, // 临时密钥的 sessionToken\n                    ExpiredTime: config.expiredTime // 临时密钥失效时间戳，是申请临时密钥时，时间戳加 durationSeconds\n                });\n            }\n        });\n        let fileObject = file.target.files[0];\n        console.log(fileObject);\n        let Key = fileObject.name;\n        let pos = Key.lastIndexOf('.');\n        let suffix = '';\n        if (pos !== -1) {\n            suffix = Key.substring(pos);\n        }\n        let filename = new Date().getTime() + suffix;\n        return new Promise((resolve, reject) => {\n            cos.sliceUploadFile({\n                Bucket: config.bucket, /* 必须 */\n                Region: config.region, /* 必须 */\n                Key: filename, /* 必须 */\n                Body: fileObject, // 上传文件对象\n                onProgress: function (progressData) {\n                    console.log(progressData)\n                    uploading(progressData);\n                }\n            }, function (err, data) {\n                if (err) {\n                    reject({ msg: err });\n                } else {\n                    resolve({ url: 'http://' + data.Location, ETag: data.ETag });\n                }\n            });\n        })\n    },\n    cosHttp (evfile, res, videoIng) {\n        // 腾讯云\n        // 对更多字符编码的 url encode 格式\n        let camSafeUrlEncode = function (str) {\n            return encodeURIComponent(str)\n                .replace(/!/g, '%21')\n                .replace(/'/g, '%27')\n                .replace(/\\(/g, '%28')\n                .replace(/\\)/g, '%29')\n                .replace(/\\*/g, '%2A');\n        };\n        let fileObject = evfile.target.files[0];\n        let Key = fileObject.name;\n        let pos = Key.lastIndexOf('.');\n        let suffix = '';\n        if (pos !== -1) {\n            suffix = Key.substring(pos);\n        }\n        let filename = new Date().getTime() + suffix;\n        let data = res.data;\n        let XCosSecurityToken = data.credentials.sessionToken;\n        let url = data.url + camSafeUrlEncode(filename).replace(/%2F/g, '/');\n        let xhr = new XMLHttpRequest();\n        xhr.open('PUT', url, true);\n        XCosSecurityToken && xhr.setRequestHeader('x-cos-security-token', XCosSecurityToken);\n        xhr.upload.onprogress = function (e) {\n            let progress = Math.round(e.loaded / e.total * 10000) / 100;\n            videoIng(true, progress);\n        };\n        return new Promise((resolve, reject) => {\n            xhr.onload = function () {\n                console.log('上传中');\n                if (/^2\\d\\d$/.test('' + xhr.status)) {\n                    var ETag = xhr.getResponseHeader('etag');\n                    console.log(null, { url: url, ETag: ETag });\n                    videoIng(false, 0);\n                    resolve({ url: url, ETag: ETag });\n                } else {\n                    reject({ msg: '文件 ' + filename + ' 上传失败，状态码：' + xhr.statu })\n                }\n            };\n            xhr.onerror = function () {\n                reject({ msg: '文件 ' + filename + '上传失败，请检查是否没配置 CORS 跨域规' });\n            };\n            xhr.send(fileObject);\n            xhr.onreadystatechange = function () {\n                console.log(xhr.statusText, xhr.responseText, 'xhr')\n            }\n        });\n    },\n    ossHttp (evfile, res, videoIng) {\n        let that = this;\n        let fileObject = evfile.target.files[0];\n        let file = fileObject.name;\n        let pos = file.lastIndexOf('.');\n        let suffix = '';\n        if (pos !== -1) {\n            suffix = file.substring(pos);\n        }\n        let filename = new Date().getTime() + suffix;\n        let formData = new FormData();\n        let data = res.data;\n        // 注意formData里append添加的键的大小写\n        formData.append('key', filename); // 存储在oss的文件路径\n        formData.append('OSSAccessKeyId', data.accessid); // accessKeyId\n        formData.append('policy', data.policy); // policy\n        formData.append('Signature', data.signature); // 签名\n        // 如果是base64文件，那么直接把base64字符串转成blob对象进行上传就可以了\n        formData.append('file', fileObject);\n        formData.append('success_action_status', 200); // 成功后返回的操作码\n        let url = data.host;\n        let fileUrl = url + '/' + filename;\n        videoIng(true, 100);\n        return new Promise((resolve, reject) => {\n            axios.defaults.withCredentials = false;\n            axios.post(url, formData).then(() => {\n                // that.progress = 0;\n                videoIng(false, 0);\n                resolve({ url: fileUrl });\n            }).catch(res => {\n                reject({ msg: res });\n            })\n        });\n    },\n    qiniuHttp (evfile, res, videoIng) {\n        let uptoken = res.data.token;\n        let file = evfile.target.files[0]; // Blob 对象，上传的文件\n        let Key = file.name; // 上传后文件资源名以设置的 key 为主，如果 key 为 null 或者 undefined，则文件资源名会以 hash 值作为资源名。\n        let pos = Key.lastIndexOf('.');\n        let suffix = '';\n        if (pos !== -1) {\n            suffix = Key.substring(pos);\n        }\n        let filename = new Date().getTime() + suffix;\n        let fileUrl = res.data.domain + '/' + filename;\n        let config = {\n            useCdnDomain: true\n        };\n        let putExtra = {\n            fname: '', // 文件原文件名\n            params: {}, // 用来放置自定义变量\n            mimeType: null // 用来限制上传文件类型，为 null 时表示不对文件类型限制；限制类型放到数组里： [\"image/png\", \"image/jpeg\", \"image/gif\"]\n        };\n        let observable = qiniu.upload(file, filename, uptoken, putExtra, config);\n        return new Promise((resolve, reject) => {\n            observable.subscribe({\n                next: (result) => {\n                    console.log(result);\n                    let progress = Math.round(result.total.loaded / result.total.size);\n                    videoIng(true, progress);\n                    // 主要用来展示进度\n                },\n                error: (errResult) => {\n                    // 失败报错信息\n                    reject({ msg: errResult })\n                },\n                complete: (result) => {\n                    // 接收成功后返回的信息\n                    videoIng(false, 0);\n                    resolve({ url: fileUrl });\n                }\n            })\n        });\n    }\n}\n"]}]}